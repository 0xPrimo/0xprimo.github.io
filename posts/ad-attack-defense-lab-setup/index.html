<!DOCTYPE html>
<html lang="en-gb"><head><meta charset="utf-8">
<meta http-equiv="content-type" content="text/html">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title itemprop="name">Red/Blue Team Lab Setup | Primo</title>
<meta property="og:title" content="Red/Blue Team Lab Setup | Primo" />
<meta name="twitter:title" content="Red/Blue Team Lab Setup | Primo" />
<meta itemprop="name" content="Red/Blue Team Lab Setup | Primo" />
<meta name="application-name" content="Red/Blue Team Lab Setup | Primo" />
<meta property="og:site_name" content="Awesome hugo blog" />

<meta name="description" content="Minimal Hugo blog theme with light and dark mode support">
<meta itemprop="description" content="Minimal Hugo blog theme with light and dark mode support" />
<meta property="og:description" content="Minimal Hugo blog theme with light and dark mode support" />
<meta name="twitter:description" content="Minimal Hugo blog theme with light and dark mode support" />

<meta property="og:locale" content="en-gb" />
<meta name="language" content="en-gb" />

  <link rel="alternate" hreflang="en-gb" href="https://0xprimo.github.io/posts/ad-attack-defense-lab-setup/" title="English" />





    
    
    

    <meta property="og:type" content="article" />
    <meta property="og:article:published_time" content=2025-06-15T12:37:45Z />
    <meta property="article:published_time" content=2025-06-15T12:37:45Z />
    <meta property="og:url" content="https://0xprimo.github.io/posts/ad-attack-defense-lab-setup/" />

    
    <meta property="og:article:author" content="Primo" />
    <meta property="article:author" content="Primo" />
    <meta name="author" content="Primo" />
    
    

    

    <script defer type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "Article",
        "headline": "Red/Blue Team Lab Setup",
        "author": {
        "@type": "Person",
        "name": ""
        },
        "datePublished": "2025-06-15",
        "description": "",
        "wordCount":  1165 ,
        "mainEntityOfPage": "True",
        "dateModified": "2025-06-15",
        "image": {
        "@type": "imageObject",
        "url": ""
        },
        "publisher": {
        "@type": "Organization",
        "name": "Primo"
        }
    }
    </script>


<meta name="generator" content="Hugo 0.147.1">

    
    <meta property="og:url" content="https://0xprimo.github.io/posts/ad-attack-defense-lab-setup/">
  <meta property="og:site_name" content="Primo">
  <meta property="og:title" content="Red/Blue Team Lab Setup">
  <meta property="og:description" content="Introduction This lab guide walks you through setting up an environment to monitor and analyze Windows event logs using Elasticsearch, Kibana, Fleet Server, Sysmon, and Elastic Agent.
Lab Diagram This diagram shows how our lab will look. We’ll use it as a plan for setting up the environment.
× Lab diagram Elasticsearch and Kibana Before installing Elasticsearch and Kibana, we need to assign a static IP address to our machine as shown in the lab diagram. This can be done by modifying the configuration file located at /etc/netplan/50-cloud-init.yaml.">
  <meta property="og:locale" content="en_gb">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-06-15T12:37:45+00:00">
    <meta property="article:modified_time" content="2025-06-15T12:37:45+00:00">


    
    
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Red/Blue Team Lab Setup">
  <meta name="twitter:description" content="Introduction This lab guide walks you through setting up an environment to monitor and analyze Windows event logs using Elasticsearch, Kibana, Fleet Server, Sysmon, and Elastic Agent.
Lab Diagram This diagram shows how our lab will look. We’ll use it as a plan for setting up the environment.
× Lab diagram Elasticsearch and Kibana Before installing Elasticsearch and Kibana, we need to assign a static IP address to our machine as shown in the lab diagram. This can be done by modifying the configuration file located at /etc/netplan/50-cloud-init.yaml.">


    

    <link rel="canonical" href="https://0xprimo.github.io/posts/ad-attack-defense-lab-setup/">
    <link href="/style.min.2d921c18cf1ec555ffc03d59a8adc211c402c68c930c27d6a0c306ab175a8d09.css" rel="stylesheet">
    <link href="/code-highlight.min.706d31975fec544a864cb7f0d847a73ea55ca1df91bf495fd12a177138d807cf.css" rel="stylesheet">

    
    <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
    <link rel="mask-icon" href="/icons/safari-pinned-tab.svg">
    <link rel="shortcut icon" href="/favicon.ico">




<link rel="manifest" href="https://0xprimo.github.io/site.webmanifest">

<meta name="msapplication-config" content="/browserconfig.xml">
<meta name="msapplication-TileColor" content="#2d89ef">
<meta name="theme-color" content="#434648">

    
    <link rel="icon" type="image/svg+xml" href="/icons/favicon.svg">

    
    
    
</head>
<body data-theme = "dark" class="notransition">

<script src="/js/theme.min.8961c317c5b88b953fe27525839672c9343f1058ab044696ca225656c8ba2ab0.js" integrity="sha256-iWHDF8W4i5U/4nUlg5ZyyTQ/EFirBEaWyiJWVsi6KrA="></script>

<div class="navbar" role="navigation">
    <nav class="menu" aria-label="Main Navigation">
        <a href="https://0xprimo.github.io/" class="logo">
            <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" 
viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" 
stroke-linejoin="round" class="feather feather-home">
<title>Home</title>
<path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
<polyline points="9 22 9 12 15 12 15 22"></polyline>
</svg>
        </a>
        <input type="checkbox" id="menu-trigger" class="menu-trigger" />
        <label for="menu-trigger">
            <span class="menu-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" stroke="currentColor" fill="none" viewBox="0 0 14 14"><title>Menu</title><path stroke-linecap="round" stroke-linejoin="round" d="M10.595 7L3.40726 7"></path><path stroke-linecap="round" stroke-linejoin="round" d="M10.5096 3.51488L3.49301 3.51488"></path><path stroke-linecap="round" stroke-linejoin="round" d="M10.5096 10.4851H3.49301"></path><path stroke-linecap="round" stroke-linejoin="round" d="M0.5 12.5V1.5C0.5 0.947715 0.947715 0.5 1.5 0.5H12.5C13.0523 0.5 13.5 0.947715 13.5 1.5V12.5C13.5 13.0523 13.0523 13.5 12.5 13.5H1.5C0.947715 13.5 0.5 13.0523 0.5 12.5Z"></path></svg>
            </span>
        </label>

        <div class="trigger">
            <ul class="trigger-container">
                
                
                <li>
                    <a class="menu-link " href="/">
                        Home
                    </a>
                    
                </li>
                
                <li>
                    <a class="menu-link active" href="/posts/">
                        Posts
                    </a>
                    
                </li>
                
                <li>
                    <a class="menu-link " href="/about/">
                        About
                    </a>
                    
                </li>
                
                <li class="menu-separator">
                    <span>|</span>
                </li>
                
                
            </ul>
            <a id="mode" href="#">
                <svg xmlns="http://www.w3.org/2000/svg" class="mode-sunny" width="21" height="21" viewBox="0 0 14 14" stroke-width="1">
<title>LIGHT</title><g><circle cx="7" cy="7" r="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></circle><line x1="7" y1="0.5" x2="7" y2="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="2.4" y1="2.4" x2="3.82" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="0.5" y1="7" x2="2.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="2.4" y1="11.6" x2="3.82" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="7" y1="13.5" x2="7" y2="11.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="11.6" y1="11.6" x2="10.18" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="13.5" y1="7" x2="11.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="11.6" y1="2.4" x2="10.18" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"></line></g></svg>
                <svg xmlns="http://www.w3.org/2000/svg" class="mode-moon" width="21" height="21" viewBox="0 0 14 14" stroke-width="1">
<title>DARK</title><g><circle cx="7" cy="7" r="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></circle><line x1="7" y1="0.5" x2="7" y2="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="2.4" y1="2.4" x2="3.82" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="0.5" y1="7" x2="2.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="2.4" y1="11.6" x2="3.82" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="7" y1="13.5" x2="7" y2="11.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="11.6" y1="11.6" x2="10.18" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="13.5" y1="7" x2="11.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="11.6" y1="2.4" x2="10.18" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"></line></g></svg>
            </a>
        </div>
    </nav>
</div>

<div class="wrapper post">
    <main class="page-content" aria-label="Content">
        <article>
            <header class="header">
                <h1 class="header-title">Red/Blue Team Lab Setup</h1>
                
                
                
                <div class="post-meta">
                    <time datetime="2025-06-15T12:37:45&#43;00:00" itemprop="datePublished"> 15 Jun 2025 </time>
                </div>
                
            </header>
            
    
    <details class="toc" ZgotmplZ>
        <summary><b>Table of Contents</b></summary>
        <nav id="TableOfContents">
  <ul>
    <li><a href="#lab-diagram">Lab Diagram</a></li>
    <li><a href="#elasticsearch-and-kibana">Elasticsearch and Kibana</a>
      <ul>
        <li><a href="#elasticsearch">Elasticsearch</a></li>
        <li><a href="#kibana">Kibana</a></li>
      </ul>
    </li>
    <li><a href="#fleet-server">Fleet server</a></li>
    <li><a href="#sysmon">Sysmon</a></li>
    <li><a href="#elastic-agent">Elastic Agent</a></li>
    <li><a href="#ingesting-sysmon-and-windows-defender-logs">Ingesting Sysmon and Windows Defender logs</a></li>
    <li><a href="#testing-our-lab">Testing our lab</a>
      <ul>
        <li><a href="#sysmon-1">Sysmon</a></li>
        <li><a href="#windows-defender">Windows Defender</a></li>
      </ul>
    </li>
  </ul>
</nav>
    </details>
            <div class="page-content">
                <h1 id="introduction">Introduction</h1>
<p>This lab guide walks you through setting up an environment to monitor and analyze Windows event logs using Elasticsearch, Kibana, Fleet Server, Sysmon, and Elastic Agent.</p>
<h2 id="lab-diagram">Lab Diagram</h2>
<p>This diagram shows how our lab will look. We&rsquo;ll use it as a plan for setting up the environment.</p>




<div class="clickable-image-container">
    <img src="https://0xprimo.github.io/Active-Directory-Attack-Defense/images/lab-diagram.png" 
         alt="Lab diagram"
         width="800"
         
         class="clickable-image"
         onclick="openImageModal('img-df15ce2f875854925d40561ce3e64ab8-0')"
         style="cursor: pointer;">
</div>


<div id="img-df15ce2f875854925d40561ce3e64ab8-0" class="image-modal" onclick="closeImageModal('img-df15ce2f875854925d40561ce3e64ab8-0')">
    <span class="image-modal-close">&times;</span>
    <img class="image-modal-content" src="https://0xprimo.github.io/Active-Directory-Attack-Defense/images/lab-diagram.png" alt="Lab diagram">
    <div class="image-modal-caption">Lab diagram</div>
</div>

<style>
.clickable-image {
    transition: opacity 0.3s ease;
}

.clickable-image:hover {
    opacity: 0.8;
}

.image-modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.9);
    animation: fadeIn 0.3s;
}

.image-modal-content {
    margin: auto;
    display: block;
    max-width: 90%;
    max-height: 90%;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    animation: zoomIn 0.3s;
}

.image-modal-close {
    position: absolute;
    top: 15px;
    right: 35px;
    color: #f1f1f1;
    font-size: 40px;
    font-weight: bold;
    cursor: pointer;
    z-index: 1001;
}

.image-modal-close:hover,
.image-modal-close:focus {
    color: #bbb;
    text-decoration: none;
}

.image-modal-caption {
    margin: auto;
    display: block;
    width: 80%;
    max-width: 700px;
    text-align: center;
    color: #ccc;
    padding: 10px 0;
    position: absolute;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes zoomIn {
    from { transform: translate(-50%, -50%) scale(0.5); }
    to { transform: translate(-50%, -50%) scale(1); }
}

@media only screen and (max-width: 700px) {
    .image-modal-content {
        width: 100%;
        max-width: 95%;
        max-height: 95%;
    }
    
    .image-modal-caption {
        font-size: 14px;
        bottom: 10px;
    }
    
    .image-modal-close {
        font-size: 30px;
        top: 10px;
        right: 20px;
    }
}
</style>

<script>
function openImageModal(modalId) {
    document.getElementById(modalId).style.display = "block";
    document.body.style.overflow = "hidden"; 
}

function closeImageModal(modalId) {
    document.getElementById(modalId).style.display = "none";
    document.body.style.overflow = "auto"; 
}


document.addEventListener('keydown', function(event) {
    if (event.key === 'Escape') {
        const modals = document.querySelectorAll('.image-modal');
        modals.forEach(modal => {
            if (modal.style.display === 'block') {
                modal.style.display = 'none';
                document.body.style.overflow = "auto";
            }
        });
    }
});
</script>

<h2 id="elasticsearch-and-kibana">Elasticsearch and Kibana</h2>
<p>Before installing Elasticsearch and Kibana, we need to assign a static IP address to our machine as shown in the lab diagram. This can be done by modifying the configuration file located at /etc/netplan/50-cloud-init.yaml.</p>




<div class="clickable-image-container">
    <img src="https://0xprimo.github.io/Active-Directory-Attack-Defense/images/adapter-config-file.png" 
         alt="Adapter Config File"
         width="800"
         
         class="clickable-image"
         onclick="openImageModal('img-91d8cae18030ff75cf5e4379b554beb9-1')"
         style="cursor: pointer;">
</div>


<div id="img-91d8cae18030ff75cf5e4379b554beb9-1" class="image-modal" onclick="closeImageModal('img-91d8cae18030ff75cf5e4379b554beb9-1')">
    <span class="image-modal-close">&times;</span>
    <img class="image-modal-content" src="https://0xprimo.github.io/Active-Directory-Attack-Defense/images/adapter-config-file.png" alt="Adapter Config File">
    <div class="image-modal-caption">Adapter Config File</div>
</div>

<style>
.clickable-image {
    transition: opacity 0.3s ease;
}

.clickable-image:hover {
    opacity: 0.8;
}

.image-modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.9);
    animation: fadeIn 0.3s;
}

.image-modal-content {
    margin: auto;
    display: block;
    max-width: 90%;
    max-height: 90%;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    animation: zoomIn 0.3s;
}

.image-modal-close {
    position: absolute;
    top: 15px;
    right: 35px;
    color: #f1f1f1;
    font-size: 40px;
    font-weight: bold;
    cursor: pointer;
    z-index: 1001;
}

.image-modal-close:hover,
.image-modal-close:focus {
    color: #bbb;
    text-decoration: none;
}

.image-modal-caption {
    margin: auto;
    display: block;
    width: 80%;
    max-width: 700px;
    text-align: center;
    color: #ccc;
    padding: 10px 0;
    position: absolute;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes zoomIn {
    from { transform: translate(-50%, -50%) scale(0.5); }
    to { transform: translate(-50%, -50%) scale(1); }
}

@media only screen and (max-width: 700px) {
    .image-modal-content {
        width: 100%;
        max-width: 95%;
        max-height: 95%;
    }
    
    .image-modal-caption {
        font-size: 14px;
        bottom: 10px;
    }
    
    .image-modal-close {
        font-size: 30px;
        top: 10px;
        right: 20px;
    }
}
</style>

<script>
function openImageModal(modalId) {
    document.getElementById(modalId).style.display = "block";
    document.body.style.overflow = "hidden"; 
}

function closeImageModal(modalId) {
    document.getElementById(modalId).style.display = "none";
    document.body.style.overflow = "auto"; 
}


document.addEventListener('keydown', function(event) {
    if (event.key === 'Escape') {
        const modals = document.querySelectorAll('.image-modal');
        modals.forEach(modal => {
            if (modal.style.display === 'block') {
                modal.style.display = 'none';
                document.body.style.overflow = "auto";
            }
        });
    }
});
</script>

<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yml" data-lang="yml"><span class="line"><span class="cl"><span class="nt">network</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="m">2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">ethernets</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">ens32</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">dhcp4</span><span class="p">:</span><span class="w"> </span><span class="kc">no</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">addresses</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="m">172.16.46.100</span><span class="l">/24</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">gateway4</span><span class="p">:</span><span class="w"> </span><span class="m">172.16.46.2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">nameservers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">addresses</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="m">8.8.8.8</span><span class="p">,</span><span class="w"> </span><span class="m">1.1.1.1</span><span class="p">]</span><span class="w">
</span></span></span></code></pre></div><p>Save and close the file, then run the following command to apply the changes:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">sudo netplan apply
</span></span></code></pre></div><p>Verify the static IP configuration by running:</p>




<div class="clickable-image-container">
    <img src="https://0xprimo.github.io/Active-Directory-Attack-Defense/images/adapter-info.png" 
         alt="Adapter Info"
         width="800"
         
         class="clickable-image"
         onclick="openImageModal('img-d9584cb51c2f51f3425ff40abeb0087a-2')"
         style="cursor: pointer;">
</div>


<div id="img-d9584cb51c2f51f3425ff40abeb0087a-2" class="image-modal" onclick="closeImageModal('img-d9584cb51c2f51f3425ff40abeb0087a-2')">
    <span class="image-modal-close">&times;</span>
    <img class="image-modal-content" src="https://0xprimo.github.io/Active-Directory-Attack-Defense/images/adapter-info.png" alt="Adapter Info">
    <div class="image-modal-caption">Adapter Info</div>
</div>

<style>
.clickable-image {
    transition: opacity 0.3s ease;
}

.clickable-image:hover {
    opacity: 0.8;
}

.image-modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.9);
    animation: fadeIn 0.3s;
}

.image-modal-content {
    margin: auto;
    display: block;
    max-width: 90%;
    max-height: 90%;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    animation: zoomIn 0.3s;
}

.image-modal-close {
    position: absolute;
    top: 15px;
    right: 35px;
    color: #f1f1f1;
    font-size: 40px;
    font-weight: bold;
    cursor: pointer;
    z-index: 1001;
}

.image-modal-close:hover,
.image-modal-close:focus {
    color: #bbb;
    text-decoration: none;
}

.image-modal-caption {
    margin: auto;
    display: block;
    width: 80%;
    max-width: 700px;
    text-align: center;
    color: #ccc;
    padding: 10px 0;
    position: absolute;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes zoomIn {
    from { transform: translate(-50%, -50%) scale(0.5); }
    to { transform: translate(-50%, -50%) scale(1); }
}

@media only screen and (max-width: 700px) {
    .image-modal-content {
        width: 100%;
        max-width: 95%;
        max-height: 95%;
    }
    
    .image-modal-caption {
        font-size: 14px;
        bottom: 10px;
    }
    
    .image-modal-close {
        font-size: 30px;
        top: 10px;
        right: 20px;
    }
}
</style>

<script>
function openImageModal(modalId) {
    document.getElementById(modalId).style.display = "block";
    document.body.style.overflow = "hidden"; 
}

function closeImageModal(modalId) {
    document.getElementById(modalId).style.display = "none";
    document.body.style.overflow = "auto"; 
}


document.addEventListener('keydown', function(event) {
    if (event.key === 'Escape') {
        const modals = document.querySelectorAll('.image-modal');
        modals.forEach(modal => {
            if (modal.style.display === 'block') {
                modal.style.display = 'none';
                document.body.style.overflow = "auto";
            }
        });
    }
});
</script>

<h3 id="elasticsearch">Elasticsearch</h3>
<p>In this lab, Elasticsearch will store Windows event logs and enable querying and searching through them.</p>
<p>Download the Elasticsearch Debian package (.deb) from the official Elastic website <a href="https://www.elastic.co/downloads/elasticsearch">here</a>. Install it using:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">sudo dpkg -i elasticsearch-9.0.2-amd64.deb
</span></span></code></pre></div><p>{&lt; img src=&ldquo;Active-Directory-Attack-Defense/images/download-elastic-search-debian-package.png&rdquo; alt=&ldquo;Download Elasticsearch Package&rdquo; width=&ldquo;800&rdquo; &gt;}}</p>
<p>The installation process will display a superuser password. Save this password for authenticating to Elasticsearch authentication.</p>




<div class="clickable-image-container">
    <img src="https://0xprimo.github.io/Active-Directory-Attack-Defense/images/elasticsearch-superuser-password.png" 
         alt="Elasticsearch Superuser Password"
         width="800"
         
         class="clickable-image"
         onclick="openImageModal('img-5ac9816fc3eb9a91ac0c074e9b268fe0-3')"
         style="cursor: pointer;">
</div>


<div id="img-5ac9816fc3eb9a91ac0c074e9b268fe0-3" class="image-modal" onclick="closeImageModal('img-5ac9816fc3eb9a91ac0c074e9b268fe0-3')">
    <span class="image-modal-close">&times;</span>
    <img class="image-modal-content" src="https://0xprimo.github.io/Active-Directory-Attack-Defense/images/elasticsearch-superuser-password.png" alt="Elasticsearch Superuser Password">
    <div class="image-modal-caption">Elasticsearch Superuser Password</div>
</div>

<style>
.clickable-image {
    transition: opacity 0.3s ease;
}

.clickable-image:hover {
    opacity: 0.8;
}

.image-modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.9);
    animation: fadeIn 0.3s;
}

.image-modal-content {
    margin: auto;
    display: block;
    max-width: 90%;
    max-height: 90%;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    animation: zoomIn 0.3s;
}

.image-modal-close {
    position: absolute;
    top: 15px;
    right: 35px;
    color: #f1f1f1;
    font-size: 40px;
    font-weight: bold;
    cursor: pointer;
    z-index: 1001;
}

.image-modal-close:hover,
.image-modal-close:focus {
    color: #bbb;
    text-decoration: none;
}

.image-modal-caption {
    margin: auto;
    display: block;
    width: 80%;
    max-width: 700px;
    text-align: center;
    color: #ccc;
    padding: 10px 0;
    position: absolute;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes zoomIn {
    from { transform: translate(-50%, -50%) scale(0.5); }
    to { transform: translate(-50%, -50%) scale(1); }
}

@media only screen and (max-width: 700px) {
    .image-modal-content {
        width: 100%;
        max-width: 95%;
        max-height: 95%;
    }
    
    .image-modal-caption {
        font-size: 14px;
        bottom: 10px;
    }
    
    .image-modal-close {
        font-size: 30px;
        top: 10px;
        right: 20px;
    }
}
</style>

<script>
function openImageModal(modalId) {
    document.getElementById(modalId).style.display = "block";
    document.body.style.overflow = "hidden"; 
}

function closeImageModal(modalId) {
    document.getElementById(modalId).style.display = "none";
    document.body.style.overflow = "auto"; 
}


document.addEventListener('keydown', function(event) {
    if (event.key === 'Escape') {
        const modals = document.querySelectorAll('.image-modal');
        modals.forEach(modal => {
            if (modal.style.display === 'block') {
                modal.style.display = 'none';
                document.body.style.overflow = "auto";
            }
        });
    }
});
</script>

<p>Before starting the Elasticsearch service, configure the host and port by editing <code>/etc/elasticsearch/elasticsearch.yml</code>. Set <code>network.host</code> to the server IP <code>172.16.46.100</code> and <code>http.port</code> to <code>9200</code>.</p>




<div class="clickable-image-container">
    <img src="https://0xprimo.github.io/Active-Directory-Attack-Defense/images/elasticsearch-config.png" 
         alt="Elasticsearch Config"
         width="800"
         
         class="clickable-image"
         onclick="openImageModal('img-f2650fd5051cd0f966dd6b9f8b3f1ad1-4')"
         style="cursor: pointer;">
</div>


<div id="img-f2650fd5051cd0f966dd6b9f8b3f1ad1-4" class="image-modal" onclick="closeImageModal('img-f2650fd5051cd0f966dd6b9f8b3f1ad1-4')">
    <span class="image-modal-close">&times;</span>
    <img class="image-modal-content" src="https://0xprimo.github.io/Active-Directory-Attack-Defense/images/elasticsearch-config.png" alt="Elasticsearch Config">
    <div class="image-modal-caption">Elasticsearch Config</div>
</div>

<style>
.clickable-image {
    transition: opacity 0.3s ease;
}

.clickable-image:hover {
    opacity: 0.8;
}

.image-modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.9);
    animation: fadeIn 0.3s;
}

.image-modal-content {
    margin: auto;
    display: block;
    max-width: 90%;
    max-height: 90%;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    animation: zoomIn 0.3s;
}

.image-modal-close {
    position: absolute;
    top: 15px;
    right: 35px;
    color: #f1f1f1;
    font-size: 40px;
    font-weight: bold;
    cursor: pointer;
    z-index: 1001;
}

.image-modal-close:hover,
.image-modal-close:focus {
    color: #bbb;
    text-decoration: none;
}

.image-modal-caption {
    margin: auto;
    display: block;
    width: 80%;
    max-width: 700px;
    text-align: center;
    color: #ccc;
    padding: 10px 0;
    position: absolute;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes zoomIn {
    from { transform: translate(-50%, -50%) scale(0.5); }
    to { transform: translate(-50%, -50%) scale(1); }
}

@media only screen and (max-width: 700px) {
    .image-modal-content {
        width: 100%;
        max-width: 95%;
        max-height: 95%;
    }
    
    .image-modal-caption {
        font-size: 14px;
        bottom: 10px;
    }
    
    .image-modal-close {
        font-size: 30px;
        top: 10px;
        right: 20px;
    }
}
</style>

<script>
function openImageModal(modalId) {
    document.getElementById(modalId).style.display = "block";
    document.body.style.overflow = "hidden"; 
}

function closeImageModal(modalId) {
    document.getElementById(modalId).style.display = "none";
    document.body.style.overflow = "auto"; 
}


document.addEventListener('keydown', function(event) {
    if (event.key === 'Escape') {
        const modals = document.querySelectorAll('.image-modal');
        modals.forEach(modal => {
            if (modal.style.display === 'block') {
                modal.style.display = 'none';
                document.body.style.overflow = "auto";
            }
        });
    }
});
</script>

<p>Start and enable the Elasticsearch service:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"> sudo systemctl <span class="nb">enable</span> elasticsearch.service
</span></span><span class="line"><span class="cl"> sudo systemctl start elasticsearch.service
</span></span></code></pre></div>



<div class="clickable-image-container">
    <img src="https://0xprimo.github.io/Active-Directory-Attack-Defense/images/elasticsearch-service-running.png" 
         alt="Elasticsearch Service"
         width="800"
         
         class="clickable-image"
         onclick="openImageModal('img-423845868b57ab32199e3ac4b3342403-5')"
         style="cursor: pointer;">
</div>


<div id="img-423845868b57ab32199e3ac4b3342403-5" class="image-modal" onclick="closeImageModal('img-423845868b57ab32199e3ac4b3342403-5')">
    <span class="image-modal-close">&times;</span>
    <img class="image-modal-content" src="https://0xprimo.github.io/Active-Directory-Attack-Defense/images/elasticsearch-service-running.png" alt="Elasticsearch Service">
    <div class="image-modal-caption">Elasticsearch Service</div>
</div>

<style>
.clickable-image {
    transition: opacity 0.3s ease;
}

.clickable-image:hover {
    opacity: 0.8;
}

.image-modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.9);
    animation: fadeIn 0.3s;
}

.image-modal-content {
    margin: auto;
    display: block;
    max-width: 90%;
    max-height: 90%;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    animation: zoomIn 0.3s;
}

.image-modal-close {
    position: absolute;
    top: 15px;
    right: 35px;
    color: #f1f1f1;
    font-size: 40px;
    font-weight: bold;
    cursor: pointer;
    z-index: 1001;
}

.image-modal-close:hover,
.image-modal-close:focus {
    color: #bbb;
    text-decoration: none;
}

.image-modal-caption {
    margin: auto;
    display: block;
    width: 80%;
    max-width: 700px;
    text-align: center;
    color: #ccc;
    padding: 10px 0;
    position: absolute;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes zoomIn {
    from { transform: translate(-50%, -50%) scale(0.5); }
    to { transform: translate(-50%, -50%) scale(1); }
}

@media only screen and (max-width: 700px) {
    .image-modal-content {
        width: 100%;
        max-width: 95%;
        max-height: 95%;
    }
    
    .image-modal-caption {
        font-size: 14px;
        bottom: 10px;
    }
    
    .image-modal-close {
        font-size: 30px;
        top: 10px;
        right: 20px;
    }
}
</style>

<script>
function openImageModal(modalId) {
    document.getElementById(modalId).style.display = "block";
    document.body.style.overflow = "hidden"; 
}

function closeImageModal(modalId) {
    document.getElementById(modalId).style.display = "none";
    document.body.style.overflow = "auto"; 
}


document.addEventListener('keydown', function(event) {
    if (event.key === 'Escape') {
        const modals = document.querySelectorAll('.image-modal');
        modals.forEach(modal => {
            if (modal.style.display === 'block') {
                modal.style.display = 'none';
                document.body.style.overflow = "auto";
            }
        });
    }
});
</script>

<h3 id="kibana">Kibana</h3>
<p>Kibana provides a web UI to manage agent policies, create detection rules, and search through events.</p>
<p>Download the Kibana Debian package (.deb) from the official Elastic website <a href="https://www.elastic.co/downloads/kibana">here</a>.</p>




<div class="clickable-image-container">
    <img src="https://0xprimo.github.io/Active-Directory-Attack-Defense/images/download-kibana-debian-package.png" 
         alt="Download Kibana Package"
         width="800"
         
         class="clickable-image"
         onclick="openImageModal('img-f2f4de32f40ae6b8ab3b28fea725e26d-6')"
         style="cursor: pointer;">
</div>


<div id="img-f2f4de32f40ae6b8ab3b28fea725e26d-6" class="image-modal" onclick="closeImageModal('img-f2f4de32f40ae6b8ab3b28fea725e26d-6')">
    <span class="image-modal-close">&times;</span>
    <img class="image-modal-content" src="https://0xprimo.github.io/Active-Directory-Attack-Defense/images/download-kibana-debian-package.png" alt="Download Kibana Package">
    <div class="image-modal-caption">Download Kibana Package</div>
</div>

<style>
.clickable-image {
    transition: opacity 0.3s ease;
}

.clickable-image:hover {
    opacity: 0.8;
}

.image-modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.9);
    animation: fadeIn 0.3s;
}

.image-modal-content {
    margin: auto;
    display: block;
    max-width: 90%;
    max-height: 90%;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    animation: zoomIn 0.3s;
}

.image-modal-close {
    position: absolute;
    top: 15px;
    right: 35px;
    color: #f1f1f1;
    font-size: 40px;
    font-weight: bold;
    cursor: pointer;
    z-index: 1001;
}

.image-modal-close:hover,
.image-modal-close:focus {
    color: #bbb;
    text-decoration: none;
}

.image-modal-caption {
    margin: auto;
    display: block;
    width: 80%;
    max-width: 700px;
    text-align: center;
    color: #ccc;
    padding: 10px 0;
    position: absolute;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes zoomIn {
    from { transform: translate(-50%, -50%) scale(0.5); }
    to { transform: translate(-50%, -50%) scale(1); }
}

@media only screen and (max-width: 700px) {
    .image-modal-content {
        width: 100%;
        max-width: 95%;
        max-height: 95%;
    }
    
    .image-modal-caption {
        font-size: 14px;
        bottom: 10px;
    }
    
    .image-modal-close {
        font-size: 30px;
        top: 10px;
        right: 20px;
    }
}
</style>

<script>
function openImageModal(modalId) {
    document.getElementById(modalId).style.display = "block";
    document.body.style.overflow = "hidden"; 
}

function closeImageModal(modalId) {
    document.getElementById(modalId).style.display = "none";
    document.body.style.overflow = "auto"; 
}


document.addEventListener('keydown', function(event) {
    if (event.key === 'Escape') {
        const modals = document.querySelectorAll('.image-modal');
        modals.forEach(modal => {
            if (modal.style.display === 'block') {
                modal.style.display = 'none';
                document.body.style.overflow = "auto";
            }
        });
    }
});
</script>

<p>Install it using:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">sudo dpkg -i kibana-9.0.2-amd64.deb
</span></span></code></pre></div>



<div class="clickable-image-container">
    <img src="https://0xprimo.github.io/Active-Directory-Attack-Defense/images/kibana-install.png" 
         alt="Installing Kibana Package"
         width="800"
         
         class="clickable-image"
         onclick="openImageModal('img-b148f1fbd5f735afedf7b97fba8bfecb-7')"
         style="cursor: pointer;">
</div>


<div id="img-b148f1fbd5f735afedf7b97fba8bfecb-7" class="image-modal" onclick="closeImageModal('img-b148f1fbd5f735afedf7b97fba8bfecb-7')">
    <span class="image-modal-close">&times;</span>
    <img class="image-modal-content" src="https://0xprimo.github.io/Active-Directory-Attack-Defense/images/kibana-install.png" alt="Installing Kibana Package">
    <div class="image-modal-caption">Installing Kibana Package</div>
</div>

<style>
.clickable-image {
    transition: opacity 0.3s ease;
}

.clickable-image:hover {
    opacity: 0.8;
}

.image-modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.9);
    animation: fadeIn 0.3s;
}

.image-modal-content {
    margin: auto;
    display: block;
    max-width: 90%;
    max-height: 90%;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    animation: zoomIn 0.3s;
}

.image-modal-close {
    position: absolute;
    top: 15px;
    right: 35px;
    color: #f1f1f1;
    font-size: 40px;
    font-weight: bold;
    cursor: pointer;
    z-index: 1001;
}

.image-modal-close:hover,
.image-modal-close:focus {
    color: #bbb;
    text-decoration: none;
}

.image-modal-caption {
    margin: auto;
    display: block;
    width: 80%;
    max-width: 700px;
    text-align: center;
    color: #ccc;
    padding: 10px 0;
    position: absolute;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes zoomIn {
    from { transform: translate(-50%, -50%) scale(0.5); }
    to { transform: translate(-50%, -50%) scale(1); }
}

@media only screen and (max-width: 700px) {
    .image-modal-content {
        width: 100%;
        max-width: 95%;
        max-height: 95%;
    }
    
    .image-modal-caption {
        font-size: 14px;
        bottom: 10px;
    }
    
    .image-modal-close {
        font-size: 30px;
        top: 10px;
        right: 20px;
    }
}
</style>

<script>
function openImageModal(modalId) {
    document.getElementById(modalId).style.display = "block";
    document.body.style.overflow = "hidden"; 
}

function closeImageModal(modalId) {
    document.getElementById(modalId).style.display = "none";
    document.body.style.overflow = "auto"; 
}


document.addEventListener('keydown', function(event) {
    if (event.key === 'Escape') {
        const modals = document.querySelectorAll('.image-modal');
        modals.forEach(modal => {
            if (modal.style.display === 'block') {
                modal.style.display = 'none';
                document.body.style.overflow = "auto";
            }
        });
    }
});
</script>

<p>Configure Kibana by editing <code>/etc/kibana/kibana.yml</code> to set the host and port it will listen on.</p>




<div class="clickable-image-container">
    <img src="https://0xprimo.github.io/Active-Directory-Attack-Defense/images/kibana-config.png" 
         alt="Kibana Config"
         width="800"
         
         class="clickable-image"
         onclick="openImageModal('img-7d44fabdbb6008167ce393ae81685f22-8')"
         style="cursor: pointer;">
</div>


<div id="img-7d44fabdbb6008167ce393ae81685f22-8" class="image-modal" onclick="closeImageModal('img-7d44fabdbb6008167ce393ae81685f22-8')">
    <span class="image-modal-close">&times;</span>
    <img class="image-modal-content" src="https://0xprimo.github.io/Active-Directory-Attack-Defense/images/kibana-config.png" alt="Kibana Config">
    <div class="image-modal-caption">Kibana Config</div>
</div>

<style>
.clickable-image {
    transition: opacity 0.3s ease;
}

.clickable-image:hover {
    opacity: 0.8;
}

.image-modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.9);
    animation: fadeIn 0.3s;
}

.image-modal-content {
    margin: auto;
    display: block;
    max-width: 90%;
    max-height: 90%;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    animation: zoomIn 0.3s;
}

.image-modal-close {
    position: absolute;
    top: 15px;
    right: 35px;
    color: #f1f1f1;
    font-size: 40px;
    font-weight: bold;
    cursor: pointer;
    z-index: 1001;
}

.image-modal-close:hover,
.image-modal-close:focus {
    color: #bbb;
    text-decoration: none;
}

.image-modal-caption {
    margin: auto;
    display: block;
    width: 80%;
    max-width: 700px;
    text-align: center;
    color: #ccc;
    padding: 10px 0;
    position: absolute;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes zoomIn {
    from { transform: translate(-50%, -50%) scale(0.5); }
    to { transform: translate(-50%, -50%) scale(1); }
}

@media only screen and (max-width: 700px) {
    .image-modal-content {
        width: 100%;
        max-width: 95%;
        max-height: 95%;
    }
    
    .image-modal-caption {
        font-size: 14px;
        bottom: 10px;
    }
    
    .image-modal-close {
        font-size: 30px;
        top: 10px;
        right: 20px;
    }
}
</style>

<script>
function openImageModal(modalId) {
    document.getElementById(modalId).style.display = "block";
    document.body.style.overflow = "hidden"; 
}

function closeImageModal(modalId) {
    document.getElementById(modalId).style.display = "none";
    document.body.style.overflow = "auto"; 
}


document.addEventListener('keydown', function(event) {
    if (event.key === 'Escape') {
        const modals = document.querySelectorAll('.image-modal');
        modals.forEach(modal => {
            if (modal.style.display === 'block') {
                modal.style.display = 'none';
                document.body.style.overflow = "auto";
            }
        });
    }
});
</script>

<p>Enable and start the Kibana service:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">sudo systemctl <span class="nb">enable</span> kibana
</span></span><span class="line"><span class="cl">sudo systemctl start kibana
</span></span><span class="line"><span class="cl">sudo systemctl status kibana // check service status
</span></span></code></pre></div>



<div class="clickable-image-container">
    <img src="https://0xprimo.github.io/Active-Directory-Attack-Defense/images/kibana-service-running.png" 
         alt="Kibana Service Status"
         width="800"
         
         class="clickable-image"
         onclick="openImageModal('img-7aa4e1f5de5340112763d80ad61c45f7-9')"
         style="cursor: pointer;">
</div>


<div id="img-7aa4e1f5de5340112763d80ad61c45f7-9" class="image-modal" onclick="closeImageModal('img-7aa4e1f5de5340112763d80ad61c45f7-9')">
    <span class="image-modal-close">&times;</span>
    <img class="image-modal-content" src="https://0xprimo.github.io/Active-Directory-Attack-Defense/images/kibana-service-running.png" alt="Kibana Service Status">
    <div class="image-modal-caption">Kibana Service Status</div>
</div>

<style>
.clickable-image {
    transition: opacity 0.3s ease;
}

.clickable-image:hover {
    opacity: 0.8;
}

.image-modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.9);
    animation: fadeIn 0.3s;
}

.image-modal-content {
    margin: auto;
    display: block;
    max-width: 90%;
    max-height: 90%;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    animation: zoomIn 0.3s;
}

.image-modal-close {
    position: absolute;
    top: 15px;
    right: 35px;
    color: #f1f1f1;
    font-size: 40px;
    font-weight: bold;
    cursor: pointer;
    z-index: 1001;
}

.image-modal-close:hover,
.image-modal-close:focus {
    color: #bbb;
    text-decoration: none;
}

.image-modal-caption {
    margin: auto;
    display: block;
    width: 80%;
    max-width: 700px;
    text-align: center;
    color: #ccc;
    padding: 10px 0;
    position: absolute;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes zoomIn {
    from { transform: translate(-50%, -50%) scale(0.5); }
    to { transform: translate(-50%, -50%) scale(1); }
}

@media only screen and (max-width: 700px) {
    .image-modal-content {
        width: 100%;
        max-width: 95%;
        max-height: 95%;
    }
    
    .image-modal-caption {
        font-size: 14px;
        bottom: 10px;
    }
    
    .image-modal-close {
        font-size: 30px;
        top: 10px;
        right: 20px;
    }
}
</style>

<script>
function openImageModal(modalId) {
    document.getElementById(modalId).style.display = "block";
    document.body.style.overflow = "hidden"; 
}

function closeImageModal(modalId) {
    document.getElementById(modalId).style.display = "none";
    document.body.style.overflow = "auto"; 
}


document.addEventListener('keydown', function(event) {
    if (event.key === 'Escape') {
        const modals = document.querySelectorAll('.image-modal');
        modals.forEach(modal => {
            if (modal.style.display === 'block') {
                modal.style.display = 'none';
                document.body.style.overflow = "auto";
            }
        });
    }
});
</script>

<p>Assign hostnames to each virtual machine by editing the <code>/etc/hosts</code> file on the host machine. For Windows, edit <code>C:\Windows\System32\drivers\etc\hosts</code>.</p>




<div class="clickable-image-container">
    <img src="https://0xprimo.github.io/Active-Directory-Attack-Defense/images/set-vms-hostname.png" 
         alt="Set Hostname to VMs"
         width="800"
         
         class="clickable-image"
         onclick="openImageModal('img-bfe444bd2811d944619e621c6f78f0d5-10')"
         style="cursor: pointer;">
</div>


<div id="img-bfe444bd2811d944619e621c6f78f0d5-10" class="image-modal" onclick="closeImageModal('img-bfe444bd2811d944619e621c6f78f0d5-10')">
    <span class="image-modal-close">&times;</span>
    <img class="image-modal-content" src="https://0xprimo.github.io/Active-Directory-Attack-Defense/images/set-vms-hostname.png" alt="Set Hostname to VMs">
    <div class="image-modal-caption">Set Hostname to VMs</div>
</div>

<style>
.clickable-image {
    transition: opacity 0.3s ease;
}

.clickable-image:hover {
    opacity: 0.8;
}

.image-modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.9);
    animation: fadeIn 0.3s;
}

.image-modal-content {
    margin: auto;
    display: block;
    max-width: 90%;
    max-height: 90%;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    animation: zoomIn 0.3s;
}

.image-modal-close {
    position: absolute;
    top: 15px;
    right: 35px;
    color: #f1f1f1;
    font-size: 40px;
    font-weight: bold;
    cursor: pointer;
    z-index: 1001;
}

.image-modal-close:hover,
.image-modal-close:focus {
    color: #bbb;
    text-decoration: none;
}

.image-modal-caption {
    margin: auto;
    display: block;
    width: 80%;
    max-width: 700px;
    text-align: center;
    color: #ccc;
    padding: 10px 0;
    position: absolute;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes zoomIn {
    from { transform: translate(-50%, -50%) scale(0.5); }
    to { transform: translate(-50%, -50%) scale(1); }
}

@media only screen and (max-width: 700px) {
    .image-modal-content {
        width: 100%;
        max-width: 95%;
        max-height: 95%;
    }
    
    .image-modal-caption {
        font-size: 14px;
        bottom: 10px;
    }
    
    .image-modal-close {
        font-size: 30px;
        top: 10px;
        right: 20px;
    }
}
</style>

<script>
function openImageModal(modalId) {
    document.getElementById(modalId).style.display = "block";
    document.body.style.overflow = "hidden"; 
}

function closeImageModal(modalId) {
    document.getElementById(modalId).style.display = "none";
    document.body.style.overflow = "auto"; 
}


document.addEventListener('keydown', function(event) {
    if (event.key === 'Escape') {
        const modals = document.querySelectorAll('.image-modal');
        modals.forEach(modal => {
            if (modal.style.display === 'block') {
                modal.style.display = 'none';
                document.body.style.overflow = "auto";
            }
        });
    }
});
</script>

<p>Access Kibana at <a href="http://server01.local:5601">http://server01.local:5601</a>.</p>




<div class="clickable-image-container">
    <img src="https://0xprimo.github.io/Active-Directory-Attack-Defense/images/elasticsearch-token.png" 
         alt="Kibana Ask for enrollment token"
         width="800"
         
         class="clickable-image"
         onclick="openImageModal('img-267176832cf1a94251712bac75111680-11')"
         style="cursor: pointer;">
</div>


<div id="img-267176832cf1a94251712bac75111680-11" class="image-modal" onclick="closeImageModal('img-267176832cf1a94251712bac75111680-11')">
    <span class="image-modal-close">&times;</span>
    <img class="image-modal-content" src="https://0xprimo.github.io/Active-Directory-Attack-Defense/images/elasticsearch-token.png" alt="Kibana Ask for enrollment token">
    <div class="image-modal-caption">Kibana Ask for enrollment token</div>
</div>

<style>
.clickable-image {
    transition: opacity 0.3s ease;
}

.clickable-image:hover {
    opacity: 0.8;
}

.image-modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.9);
    animation: fadeIn 0.3s;
}

.image-modal-content {
    margin: auto;
    display: block;
    max-width: 90%;
    max-height: 90%;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    animation: zoomIn 0.3s;
}

.image-modal-close {
    position: absolute;
    top: 15px;
    right: 35px;
    color: #f1f1f1;
    font-size: 40px;
    font-weight: bold;
    cursor: pointer;
    z-index: 1001;
}

.image-modal-close:hover,
.image-modal-close:focus {
    color: #bbb;
    text-decoration: none;
}

.image-modal-caption {
    margin: auto;
    display: block;
    width: 80%;
    max-width: 700px;
    text-align: center;
    color: #ccc;
    padding: 10px 0;
    position: absolute;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes zoomIn {
    from { transform: translate(-50%, -50%) scale(0.5); }
    to { transform: translate(-50%, -50%) scale(1); }
}

@media only screen and (max-width: 700px) {
    .image-modal-content {
        width: 100%;
        max-width: 95%;
        max-height: 95%;
    }
    
    .image-modal-caption {
        font-size: 14px;
        bottom: 10px;
    }
    
    .image-modal-close {
        font-size: 30px;
        top: 10px;
        right: 20px;
    }
}
</style>

<script>
function openImageModal(modalId) {
    document.getElementById(modalId).style.display = "block";
    document.body.style.overflow = "hidden"; 
}

function closeImageModal(modalId) {
    document.getElementById(modalId).style.display = "none";
    document.body.style.overflow = "auto"; 
}


document.addEventListener('keydown', function(event) {
    if (event.key === 'Escape') {
        const modals = document.querySelectorAll('.image-modal');
        modals.forEach(modal => {
            if (modal.style.display === 'block') {
                modal.style.display = 'none';
                document.body.style.overflow = "auto";
            }
        });
    }
});
</script>

<p>In order to make kibana work with elasticsearch we need to provide an enrollment token generated from elasticsearch.
we can generate this token with the binary located in <code>/usr/share/elasticsearch/bin/elasticsearch-create-enrollment-token</code>.
the following command will generate the enrollment token:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">sudo /usr/share/elasticsearch/bin/elasticsearch-create-enrollment-token --scope kibana
</span></span></code></pre></div>



<div class="clickable-image-container">
    <img src="https://0xprimo.github.io/Active-Directory-Attack-Defense/images/elasticsearch-enrollment-token.png" 
         alt="Generate elasticsearch enrollment token"
         width="800"
         
         class="clickable-image"
         onclick="openImageModal('img-3916f3764fc8aeb66681e8ec5634bba7-12')"
         style="cursor: pointer;">
</div>


<div id="img-3916f3764fc8aeb66681e8ec5634bba7-12" class="image-modal" onclick="closeImageModal('img-3916f3764fc8aeb66681e8ec5634bba7-12')">
    <span class="image-modal-close">&times;</span>
    <img class="image-modal-content" src="https://0xprimo.github.io/Active-Directory-Attack-Defense/images/elasticsearch-enrollment-token.png" alt="Generate elasticsearch enrollment token">
    <div class="image-modal-caption">Generate elasticsearch enrollment token</div>
</div>

<style>
.clickable-image {
    transition: opacity 0.3s ease;
}

.clickable-image:hover {
    opacity: 0.8;
}

.image-modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.9);
    animation: fadeIn 0.3s;
}

.image-modal-content {
    margin: auto;
    display: block;
    max-width: 90%;
    max-height: 90%;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    animation: zoomIn 0.3s;
}

.image-modal-close {
    position: absolute;
    top: 15px;
    right: 35px;
    color: #f1f1f1;
    font-size: 40px;
    font-weight: bold;
    cursor: pointer;
    z-index: 1001;
}

.image-modal-close:hover,
.image-modal-close:focus {
    color: #bbb;
    text-decoration: none;
}

.image-modal-caption {
    margin: auto;
    display: block;
    width: 80%;
    max-width: 700px;
    text-align: center;
    color: #ccc;
    padding: 10px 0;
    position: absolute;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes zoomIn {
    from { transform: translate(-50%, -50%) scale(0.5); }
    to { transform: translate(-50%, -50%) scale(1); }
}

@media only screen and (max-width: 700px) {
    .image-modal-content {
        width: 100%;
        max-width: 95%;
        max-height: 95%;
    }
    
    .image-modal-caption {
        font-size: 14px;
        bottom: 10px;
    }
    
    .image-modal-close {
        font-size: 30px;
        top: 10px;
        right: 20px;
    }
}
</style>

<script>
function openImageModal(modalId) {
    document.getElementById(modalId).style.display = "block";
    document.body.style.overflow = "hidden"; 
}

function closeImageModal(modalId) {
    document.getElementById(modalId).style.display = "none";
    document.body.style.overflow = "auto"; 
}


document.addEventListener('keydown', function(event) {
    if (event.key === 'Escape') {
        const modals = document.querySelectorAll('.image-modal');
        modals.forEach(modal => {
            if (modal.style.display === 'block') {
                modal.style.display = 'none';
                document.body.style.overflow = "auto";
            }
        });
    }
});
</script>

<p>We&rsquo;ll be asked to enter verification code you can get it from kibana service logs by running <code>sudo systemctl status kibna</code>.




<div class="clickable-image-container">
    <img src="https://0xprimo.github.io/Active-Directory-Attack-Defense/images/verification-code.png" 
         alt="Verification code"
         width="800"
         
         class="clickable-image"
         onclick="openImageModal('img-57d6815bd68a659a1543bfb75739843e-13')"
         style="cursor: pointer;">
</div>


<div id="img-57d6815bd68a659a1543bfb75739843e-13" class="image-modal" onclick="closeImageModal('img-57d6815bd68a659a1543bfb75739843e-13')">
    <span class="image-modal-close">&times;</span>
    <img class="image-modal-content" src="https://0xprimo.github.io/Active-Directory-Attack-Defense/images/verification-code.png" alt="Verification code">
    <div class="image-modal-caption">Verification code</div>
</div>

<style>
.clickable-image {
    transition: opacity 0.3s ease;
}

.clickable-image:hover {
    opacity: 0.8;
}

.image-modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.9);
    animation: fadeIn 0.3s;
}

.image-modal-content {
    margin: auto;
    display: block;
    max-width: 90%;
    max-height: 90%;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    animation: zoomIn 0.3s;
}

.image-modal-close {
    position: absolute;
    top: 15px;
    right: 35px;
    color: #f1f1f1;
    font-size: 40px;
    font-weight: bold;
    cursor: pointer;
    z-index: 1001;
}

.image-modal-close:hover,
.image-modal-close:focus {
    color: #bbb;
    text-decoration: none;
}

.image-modal-caption {
    margin: auto;
    display: block;
    width: 80%;
    max-width: 700px;
    text-align: center;
    color: #ccc;
    padding: 10px 0;
    position: absolute;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes zoomIn {
    from { transform: translate(-50%, -50%) scale(0.5); }
    to { transform: translate(-50%, -50%) scale(1); }
}

@media only screen and (max-width: 700px) {
    .image-modal-content {
        width: 100%;
        max-width: 95%;
        max-height: 95%;
    }
    
    .image-modal-caption {
        font-size: 14px;
        bottom: 10px;
    }
    
    .image-modal-close {
        font-size: 30px;
        top: 10px;
        right: 20px;
    }
}
</style>

<script>
function openImageModal(modalId) {
    document.getElementById(modalId).style.display = "block";
    document.body.style.overflow = "hidden"; 
}

function closeImageModal(modalId) {
    document.getElementById(modalId).style.display = "none";
    document.body.style.overflow = "auto"; 
}


document.addEventListener('keydown', function(event) {
    if (event.key === 'Escape') {
        const modals = document.querySelectorAll('.image-modal');
        modals.forEach(modal => {
            if (modal.style.display === 'block') {
                modal.style.display = 'none';
                document.body.style.overflow = "auto";
            }
        });
    }
});
</script>
</p>
<p>we can now login with our superuser account (elastic) and the password we saved while installing elasticsearch.




<div class="clickable-image-container">
    <img src="https://0xprimo.github.io/Active-Directory-Attack-Defense/images/kibana-user-interface.png" 
         alt="Elastic Dashboard"
         width="800"
         
         class="clickable-image"
         onclick="openImageModal('img-5d4d8d69feaf3ad2e2bae909665b39cf-14')"
         style="cursor: pointer;">
</div>


<div id="img-5d4d8d69feaf3ad2e2bae909665b39cf-14" class="image-modal" onclick="closeImageModal('img-5d4d8d69feaf3ad2e2bae909665b39cf-14')">
    <span class="image-modal-close">&times;</span>
    <img class="image-modal-content" src="https://0xprimo.github.io/Active-Directory-Attack-Defense/images/kibana-user-interface.png" alt="Elastic Dashboard">
    <div class="image-modal-caption">Elastic Dashboard</div>
</div>

<style>
.clickable-image {
    transition: opacity 0.3s ease;
}

.clickable-image:hover {
    opacity: 0.8;
}

.image-modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.9);
    animation: fadeIn 0.3s;
}

.image-modal-content {
    margin: auto;
    display: block;
    max-width: 90%;
    max-height: 90%;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    animation: zoomIn 0.3s;
}

.image-modal-close {
    position: absolute;
    top: 15px;
    right: 35px;
    color: #f1f1f1;
    font-size: 40px;
    font-weight: bold;
    cursor: pointer;
    z-index: 1001;
}

.image-modal-close:hover,
.image-modal-close:focus {
    color: #bbb;
    text-decoration: none;
}

.image-modal-caption {
    margin: auto;
    display: block;
    width: 80%;
    max-width: 700px;
    text-align: center;
    color: #ccc;
    padding: 10px 0;
    position: absolute;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes zoomIn {
    from { transform: translate(-50%, -50%) scale(0.5); }
    to { transform: translate(-50%, -50%) scale(1); }
}

@media only screen and (max-width: 700px) {
    .image-modal-content {
        width: 100%;
        max-width: 95%;
        max-height: 95%;
    }
    
    .image-modal-caption {
        font-size: 14px;
        bottom: 10px;
    }
    
    .image-modal-close {
        font-size: 30px;
        top: 10px;
        right: 20px;
    }
}
</style>

<script>
function openImageModal(modalId) {
    document.getElementById(modalId).style.display = "block";
    document.body.style.overflow = "hidden"; 
}

function closeImageModal(modalId) {
    document.getElementById(modalId).style.display = "none";
    document.body.style.overflow = "auto"; 
}


document.addEventListener('keydown', function(event) {
    if (event.key === 'Escape') {
        const modals = document.querySelectorAll('.image-modal');
        modals.forEach(modal => {
            if (modal.style.display === 'block') {
                modal.style.display = 'none';
                document.body.style.overflow = "auto";
            }
        });
    }
});
</script>
</p>
<p>if you go to <code>Security -&gt; Alerts</code> you will get the following error:




<div class="clickable-image-container">
    <img src="https://0xprimo.github.io/Active-Directory-Attack-Defense/images/kibana-error.png" 
         alt="Kibana error"
         width="800"
         
         class="clickable-image"
         onclick="openImageModal('img-e823e6c217bc55fd3ce7abc9891135fb-15')"
         style="cursor: pointer;">
</div>


<div id="img-e823e6c217bc55fd3ce7abc9891135fb-15" class="image-modal" onclick="closeImageModal('img-e823e6c217bc55fd3ce7abc9891135fb-15')">
    <span class="image-modal-close">&times;</span>
    <img class="image-modal-content" src="https://0xprimo.github.io/Active-Directory-Attack-Defense/images/kibana-error.png" alt="Kibana error">
    <div class="image-modal-caption">Kibana error</div>
</div>

<style>
.clickable-image {
    transition: opacity 0.3s ease;
}

.clickable-image:hover {
    opacity: 0.8;
}

.image-modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.9);
    animation: fadeIn 0.3s;
}

.image-modal-content {
    margin: auto;
    display: block;
    max-width: 90%;
    max-height: 90%;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    animation: zoomIn 0.3s;
}

.image-modal-close {
    position: absolute;
    top: 15px;
    right: 35px;
    color: #f1f1f1;
    font-size: 40px;
    font-weight: bold;
    cursor: pointer;
    z-index: 1001;
}

.image-modal-close:hover,
.image-modal-close:focus {
    color: #bbb;
    text-decoration: none;
}

.image-modal-caption {
    margin: auto;
    display: block;
    width: 80%;
    max-width: 700px;
    text-align: center;
    color: #ccc;
    padding: 10px 0;
    position: absolute;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes zoomIn {
    from { transform: translate(-50%, -50%) scale(0.5); }
    to { transform: translate(-50%, -50%) scale(1); }
}

@media only screen and (max-width: 700px) {
    .image-modal-content {
        width: 100%;
        max-width: 95%;
        max-height: 95%;
    }
    
    .image-modal-caption {
        font-size: 14px;
        bottom: 10px;
    }
    
    .image-modal-close {
        font-size: 30px;
        top: 10px;
        right: 20px;
    }
}
</style>

<script>
function openImageModal(modalId) {
    document.getElementById(modalId).style.display = "block";
    document.body.style.overflow = "hidden"; 
}

function closeImageModal(modalId) {
    document.getElementById(modalId).style.display = "none";
    document.body.style.overflow = "auto"; 
}


document.addEventListener('keydown', function(event) {
    if (event.key === 'Escape') {
        const modals = document.querySelectorAll('.image-modal');
        modals.forEach(modal => {
            if (modal.style.display === 'block') {
                modal.style.display = 'none';
                document.body.style.overflow = "auto";
            }
        });
    }
});
</script>
</p>
<p>To fix this error we&rsquo;ll need to generate keys for kibana to use. we can run <code>/usr/share/kibana/bin/kibana-encryption-keys generate</code> to generate those keys.</p>




<div class="clickable-image-container">
    <img src="https://0xprimo.github.io/Active-Directory-Attack-Defense/images/kibana-keys.png" 
         alt="Kibana keys"
         width="800"
         
         class="clickable-image"
         onclick="openImageModal('img-f28df10b8e24323579c588c1b6a7af4d-16')"
         style="cursor: pointer;">
</div>


<div id="img-f28df10b8e24323579c588c1b6a7af4d-16" class="image-modal" onclick="closeImageModal('img-f28df10b8e24323579c588c1b6a7af4d-16')">
    <span class="image-modal-close">&times;</span>
    <img class="image-modal-content" src="https://0xprimo.github.io/Active-Directory-Attack-Defense/images/kibana-keys.png" alt="Kibana keys">
    <div class="image-modal-caption">Kibana keys</div>
</div>

<style>
.clickable-image {
    transition: opacity 0.3s ease;
}

.clickable-image:hover {
    opacity: 0.8;
}

.image-modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.9);
    animation: fadeIn 0.3s;
}

.image-modal-content {
    margin: auto;
    display: block;
    max-width: 90%;
    max-height: 90%;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    animation: zoomIn 0.3s;
}

.image-modal-close {
    position: absolute;
    top: 15px;
    right: 35px;
    color: #f1f1f1;
    font-size: 40px;
    font-weight: bold;
    cursor: pointer;
    z-index: 1001;
}

.image-modal-close:hover,
.image-modal-close:focus {
    color: #bbb;
    text-decoration: none;
}

.image-modal-caption {
    margin: auto;
    display: block;
    width: 80%;
    max-width: 700px;
    text-align: center;
    color: #ccc;
    padding: 10px 0;
    position: absolute;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes zoomIn {
    from { transform: translate(-50%, -50%) scale(0.5); }
    to { transform: translate(-50%, -50%) scale(1); }
}

@media only screen and (max-width: 700px) {
    .image-modal-content {
        width: 100%;
        max-width: 95%;
        max-height: 95%;
    }
    
    .image-modal-caption {
        font-size: 14px;
        bottom: 10px;
    }
    
    .image-modal-close {
        font-size: 30px;
        top: 10px;
        right: 20px;
    }
}
</style>

<script>
function openImageModal(modalId) {
    document.getElementById(modalId).style.display = "block";
    document.body.style.overflow = "hidden"; 
}

function closeImageModal(modalId) {
    document.getElementById(modalId).style.display = "none";
    document.body.style.overflow = "auto"; 
}


document.addEventListener('keydown', function(event) {
    if (event.key === 'Escape') {
        const modals = document.querySelectorAll('.image-modal');
        modals.forEach(modal => {
            if (modal.style.display === 'block') {
                modal.style.display = 'none';
                document.body.style.overflow = "auto";
            }
        });
    }
});
</script>

<p>Now add them to kibana using the command <code>/usr/share/kibana/bin/kibana-keystore add &lt;name-of-the-key&gt;</code>.</p>




<div class="clickable-image-container">
    <img src="https://0xprimo.github.io/Active-Directory-Attack-Defense/images/kibana-add-keys.png" 
         alt="Adding keys to kibana"
         width="800"
         
         class="clickable-image"
         onclick="openImageModal('img-8f4b4e43796df49134982d19c8d6e198-17')"
         style="cursor: pointer;">
</div>


<div id="img-8f4b4e43796df49134982d19c8d6e198-17" class="image-modal" onclick="closeImageModal('img-8f4b4e43796df49134982d19c8d6e198-17')">
    <span class="image-modal-close">&times;</span>
    <img class="image-modal-content" src="https://0xprimo.github.io/Active-Directory-Attack-Defense/images/kibana-add-keys.png" alt="Adding keys to kibana">
    <div class="image-modal-caption">Adding keys to kibana</div>
</div>

<style>
.clickable-image {
    transition: opacity 0.3s ease;
}

.clickable-image:hover {
    opacity: 0.8;
}

.image-modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.9);
    animation: fadeIn 0.3s;
}

.image-modal-content {
    margin: auto;
    display: block;
    max-width: 90%;
    max-height: 90%;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    animation: zoomIn 0.3s;
}

.image-modal-close {
    position: absolute;
    top: 15px;
    right: 35px;
    color: #f1f1f1;
    font-size: 40px;
    font-weight: bold;
    cursor: pointer;
    z-index: 1001;
}

.image-modal-close:hover,
.image-modal-close:focus {
    color: #bbb;
    text-decoration: none;
}

.image-modal-caption {
    margin: auto;
    display: block;
    width: 80%;
    max-width: 700px;
    text-align: center;
    color: #ccc;
    padding: 10px 0;
    position: absolute;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes zoomIn {
    from { transform: translate(-50%, -50%) scale(0.5); }
    to { transform: translate(-50%, -50%) scale(1); }
}

@media only screen and (max-width: 700px) {
    .image-modal-content {
        width: 100%;
        max-width: 95%;
        max-height: 95%;
    }
    
    .image-modal-caption {
        font-size: 14px;
        bottom: 10px;
    }
    
    .image-modal-close {
        font-size: 30px;
        top: 10px;
        right: 20px;
    }
}
</style>

<script>
function openImageModal(modalId) {
    document.getElementById(modalId).style.display = "block";
    document.body.style.overflow = "hidden"; 
}

function closeImageModal(modalId) {
    document.getElementById(modalId).style.display = "none";
    document.body.style.overflow = "auto"; 
}


document.addEventListener('keydown', function(event) {
    if (event.key === 'Escape') {
        const modals = document.querySelectorAll('.image-modal');
        modals.forEach(modal => {
            if (modal.style.display === 'block') {
                modal.style.display = 'none';
                document.body.style.overflow = "auto";
            }
        });
    }
});
</script>

<p>once the keys are set we need to restart kibana service with command <code>sudo systemctl restart kibana</code>. and no errors are shown.</p>




<div class="clickable-image-container">
    <img src="https://0xprimo.github.io/Active-Directory-Attack-Defense/images/kibana-no-errors.png" 
         alt="Kibana alert dashboard"
         width="800"
         
         class="clickable-image"
         onclick="openImageModal('img-71d90178943d8a0bd7f8b26d69cd1656-18')"
         style="cursor: pointer;">
</div>


<div id="img-71d90178943d8a0bd7f8b26d69cd1656-18" class="image-modal" onclick="closeImageModal('img-71d90178943d8a0bd7f8b26d69cd1656-18')">
    <span class="image-modal-close">&times;</span>
    <img class="image-modal-content" src="https://0xprimo.github.io/Active-Directory-Attack-Defense/images/kibana-no-errors.png" alt="Kibana alert dashboard">
    <div class="image-modal-caption">Kibana alert dashboard</div>
</div>

<style>
.clickable-image {
    transition: opacity 0.3s ease;
}

.clickable-image:hover {
    opacity: 0.8;
}

.image-modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.9);
    animation: fadeIn 0.3s;
}

.image-modal-content {
    margin: auto;
    display: block;
    max-width: 90%;
    max-height: 90%;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    animation: zoomIn 0.3s;
}

.image-modal-close {
    position: absolute;
    top: 15px;
    right: 35px;
    color: #f1f1f1;
    font-size: 40px;
    font-weight: bold;
    cursor: pointer;
    z-index: 1001;
}

.image-modal-close:hover,
.image-modal-close:focus {
    color: #bbb;
    text-decoration: none;
}

.image-modal-caption {
    margin: auto;
    display: block;
    width: 80%;
    max-width: 700px;
    text-align: center;
    color: #ccc;
    padding: 10px 0;
    position: absolute;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes zoomIn {
    from { transform: translate(-50%, -50%) scale(0.5); }
    to { transform: translate(-50%, -50%) scale(1); }
}

@media only screen and (max-width: 700px) {
    .image-modal-content {
        width: 100%;
        max-width: 95%;
        max-height: 95%;
    }
    
    .image-modal-caption {
        font-size: 14px;
        bottom: 10px;
    }
    
    .image-modal-close {
        font-size: 30px;
        top: 10px;
        right: 20px;
    }
}
</style>

<script>
function openImageModal(modalId) {
    document.getElementById(modalId).style.display = "block";
    document.body.style.overflow = "hidden"; 
}

function closeImageModal(modalId) {
    document.getElementById(modalId).style.display = "none";
    document.body.style.overflow = "auto"; 
}


document.addEventListener('keydown', function(event) {
    if (event.key === 'Escape') {
        const modals = document.querySelectorAll('.image-modal');
        modals.forEach(modal => {
            if (modal.style.display === 'block') {
                modal.style.display = 'none';
                document.body.style.overflow = "auto";
            }
        });
    }
});
</script>

<h2 id="fleet-server">Fleet server</h2>
<p>Fleet server will allow us to manage multiple agents running on diffrent endpoints and apply or update policy to them. Fleet server will be running on a new ubuntu VM with the static ip shown in the lab setup diagram. the static ip can be assign following the previous steps.</p>
<p>go to <code>Management -&gt; Fleet</code> and click on <code>Add Fleet Server</code></p>




<div class="clickable-image-container">
    <img src="https://0xprimo.github.io/Active-Directory-Attack-Defense/images/fleet-server-setup.png" 
         alt="Add Fleet Server"
         width="800"
         
         class="clickable-image"
         onclick="openImageModal('img-06c62082a9fc654bbe5b57d93a48b8f2-19')"
         style="cursor: pointer;">
</div>


<div id="img-06c62082a9fc654bbe5b57d93a48b8f2-19" class="image-modal" onclick="closeImageModal('img-06c62082a9fc654bbe5b57d93a48b8f2-19')">
    <span class="image-modal-close">&times;</span>
    <img class="image-modal-content" src="https://0xprimo.github.io/Active-Directory-Attack-Defense/images/fleet-server-setup.png" alt="Add Fleet Server">
    <div class="image-modal-caption">Add Fleet Server</div>
</div>

<style>
.clickable-image {
    transition: opacity 0.3s ease;
}

.clickable-image:hover {
    opacity: 0.8;
}

.image-modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.9);
    animation: fadeIn 0.3s;
}

.image-modal-content {
    margin: auto;
    display: block;
    max-width: 90%;
    max-height: 90%;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    animation: zoomIn 0.3s;
}

.image-modal-close {
    position: absolute;
    top: 15px;
    right: 35px;
    color: #f1f1f1;
    font-size: 40px;
    font-weight: bold;
    cursor: pointer;
    z-index: 1001;
}

.image-modal-close:hover,
.image-modal-close:focus {
    color: #bbb;
    text-decoration: none;
}

.image-modal-caption {
    margin: auto;
    display: block;
    width: 80%;
    max-width: 700px;
    text-align: center;
    color: #ccc;
    padding: 10px 0;
    position: absolute;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes zoomIn {
    from { transform: translate(-50%, -50%) scale(0.5); }
    to { transform: translate(-50%, -50%) scale(1); }
}

@media only screen and (max-width: 700px) {
    .image-modal-content {
        width: 100%;
        max-width: 95%;
        max-height: 95%;
    }
    
    .image-modal-caption {
        font-size: 14px;
        bottom: 10px;
    }
    
    .image-modal-close {
        font-size: 30px;
        top: 10px;
        right: 20px;
    }
}
</style>

<script>
function openImageModal(modalId) {
    document.getElementById(modalId).style.display = "block";
    document.body.style.overflow = "hidden"; 
}

function closeImageModal(modalId) {
    document.getElementById(modalId).style.display = "none";
    document.body.style.overflow = "auto"; 
}


document.addEventListener('keydown', function(event) {
    if (event.key === 'Escape') {
        const modals = document.querySelectorAll('.image-modal');
        modals.forEach(modal => {
            if (modal.style.display === 'block') {
                modal.style.display = 'none';
                document.body.style.overflow = "auto";
            }
        });
    }
});
</script>

<p>Set fleet server name and url to where fleet server will be running on and port it listen on. 8220 is the default listening port of fleet-server.</p>




<div class="clickable-image-container">
    <img src="https://0xprimo.github.io/Active-Directory-Attack-Defense/images/fleet-server-name-url.png" 
         alt="Fleet Server Configuration"
         width="800"
         
         class="clickable-image"
         onclick="openImageModal('img-378bd83b29be4f095d5c4f6c24648f0c-20')"
         style="cursor: pointer;">
</div>


<div id="img-378bd83b29be4f095d5c4f6c24648f0c-20" class="image-modal" onclick="closeImageModal('img-378bd83b29be4f095d5c4f6c24648f0c-20')">
    <span class="image-modal-close">&times;</span>
    <img class="image-modal-content" src="https://0xprimo.github.io/Active-Directory-Attack-Defense/images/fleet-server-name-url.png" alt="Fleet Server Configuration">
    <div class="image-modal-caption">Fleet Server Configuration</div>
</div>

<style>
.clickable-image {
    transition: opacity 0.3s ease;
}

.clickable-image:hover {
    opacity: 0.8;
}

.image-modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.9);
    animation: fadeIn 0.3s;
}

.image-modal-content {
    margin: auto;
    display: block;
    max-width: 90%;
    max-height: 90%;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    animation: zoomIn 0.3s;
}

.image-modal-close {
    position: absolute;
    top: 15px;
    right: 35px;
    color: #f1f1f1;
    font-size: 40px;
    font-weight: bold;
    cursor: pointer;
    z-index: 1001;
}

.image-modal-close:hover,
.image-modal-close:focus {
    color: #bbb;
    text-decoration: none;
}

.image-modal-caption {
    margin: auto;
    display: block;
    width: 80%;
    max-width: 700px;
    text-align: center;
    color: #ccc;
    padding: 10px 0;
    position: absolute;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes zoomIn {
    from { transform: translate(-50%, -50%) scale(0.5); }
    to { transform: translate(-50%, -50%) scale(1); }
}

@media only screen and (max-width: 700px) {
    .image-modal-content {
        width: 100%;
        max-width: 95%;
        max-height: 95%;
    }
    
    .image-modal-caption {
        font-size: 14px;
        bottom: 10px;
    }
    
    .image-modal-close {
        font-size: 30px;
        top: 10px;
        right: 20px;
    }
}
</style>

<script>
function openImageModal(modalId) {
    document.getElementById(modalId).style.display = "block";
    document.body.style.overflow = "hidden"; 
}

function closeImageModal(modalId) {
    document.getElementById(modalId).style.display = "none";
    document.body.style.overflow = "auto"; 
}


document.addEventListener('keydown', function(event) {
    if (event.key === 'Escape') {
        const modals = document.querySelectorAll('.image-modal');
        modals.forEach(modal => {
            if (modal.style.display === 'block') {
                modal.style.display = 'none';
                document.body.style.overflow = "auto";
            }
        });
    }
});
</script>

<p>run command on the VM to install fleet-server agent.</p>




<div class="clickable-image-container">
    <img src="https://0xprimo.github.io/Active-Directory-Attack-Defense/images/fleet-server-install-command.png" 
         alt="Fleet Server Install Command"
         width="800"
         
         class="clickable-image"
         onclick="openImageModal('img-d763e2151b03f7acb7439d34ea4a1623-21')"
         style="cursor: pointer;">
</div>


<div id="img-d763e2151b03f7acb7439d34ea4a1623-21" class="image-modal" onclick="closeImageModal('img-d763e2151b03f7acb7439d34ea4a1623-21')">
    <span class="image-modal-close">&times;</span>
    <img class="image-modal-content" src="https://0xprimo.github.io/Active-Directory-Attack-Defense/images/fleet-server-install-command.png" alt="Fleet Server Install Command">
    <div class="image-modal-caption">Fleet Server Install Command</div>
</div>

<style>
.clickable-image {
    transition: opacity 0.3s ease;
}

.clickable-image:hover {
    opacity: 0.8;
}

.image-modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.9);
    animation: fadeIn 0.3s;
}

.image-modal-content {
    margin: auto;
    display: block;
    max-width: 90%;
    max-height: 90%;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    animation: zoomIn 0.3s;
}

.image-modal-close {
    position: absolute;
    top: 15px;
    right: 35px;
    color: #f1f1f1;
    font-size: 40px;
    font-weight: bold;
    cursor: pointer;
    z-index: 1001;
}

.image-modal-close:hover,
.image-modal-close:focus {
    color: #bbb;
    text-decoration: none;
}

.image-modal-caption {
    margin: auto;
    display: block;
    width: 80%;
    max-width: 700px;
    text-align: center;
    color: #ccc;
    padding: 10px 0;
    position: absolute;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes zoomIn {
    from { transform: translate(-50%, -50%) scale(0.5); }
    to { transform: translate(-50%, -50%) scale(1); }
}

@media only screen and (max-width: 700px) {
    .image-modal-content {
        width: 100%;
        max-width: 95%;
        max-height: 95%;
    }
    
    .image-modal-caption {
        font-size: 14px;
        bottom: 10px;
    }
    
    .image-modal-close {
        font-size: 30px;
        top: 10px;
        right: 20px;
    }
}
</style>

<script>
function openImageModal(modalId) {
    document.getElementById(modalId).style.display = "block";
    document.body.style.overflow = "hidden"; 
}

function closeImageModal(modalId) {
    document.getElementById(modalId).style.display = "none";
    document.body.style.overflow = "auto"; 
}


document.addEventListener('keydown', function(event) {
    if (event.key === 'Escape') {
        const modals = document.querySelectorAll('.image-modal');
        modals.forEach(modal => {
            if (modal.style.display === 'block') {
                modal.style.display = 'none';
                document.body.style.overflow = "auto";
            }
        });
    }
});
</script>

<p>fleet-server is connected in kibana.</p>




<div class="clickable-image-container">
    <img src="https://0xprimo.github.io/Active-Directory-Attack-Defense/images/fleet-server-connected.png" 
         alt="Fleet Server Connected"
         width="800"
         
         class="clickable-image"
         onclick="openImageModal('img-ca91d6fd3783960eba0ddc56b85be541-22')"
         style="cursor: pointer;">
</div>


<div id="img-ca91d6fd3783960eba0ddc56b85be541-22" class="image-modal" onclick="closeImageModal('img-ca91d6fd3783960eba0ddc56b85be541-22')">
    <span class="image-modal-close">&times;</span>
    <img class="image-modal-content" src="https://0xprimo.github.io/Active-Directory-Attack-Defense/images/fleet-server-connected.png" alt="Fleet Server Connected">
    <div class="image-modal-caption">Fleet Server Connected</div>
</div>

<style>
.clickable-image {
    transition: opacity 0.3s ease;
}

.clickable-image:hover {
    opacity: 0.8;
}

.image-modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.9);
    animation: fadeIn 0.3s;
}

.image-modal-content {
    margin: auto;
    display: block;
    max-width: 90%;
    max-height: 90%;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    animation: zoomIn 0.3s;
}

.image-modal-close {
    position: absolute;
    top: 15px;
    right: 35px;
    color: #f1f1f1;
    font-size: 40px;
    font-weight: bold;
    cursor: pointer;
    z-index: 1001;
}

.image-modal-close:hover,
.image-modal-close:focus {
    color: #bbb;
    text-decoration: none;
}

.image-modal-caption {
    margin: auto;
    display: block;
    width: 80%;
    max-width: 700px;
    text-align: center;
    color: #ccc;
    padding: 10px 0;
    position: absolute;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes zoomIn {
    from { transform: translate(-50%, -50%) scale(0.5); }
    to { transform: translate(-50%, -50%) scale(1); }
}

@media only screen and (max-width: 700px) {
    .image-modal-content {
        width: 100%;
        max-width: 95%;
        max-height: 95%;
    }
    
    .image-modal-caption {
        font-size: 14px;
        bottom: 10px;
    }
    
    .image-modal-close {
        font-size: 30px;
        top: 10px;
        right: 20px;
    }
}
</style>

<script>
function openImageModal(modalId) {
    document.getElementById(modalId).style.display = "block";
    document.body.style.overflow = "hidden"; 
}

function closeImageModal(modalId) {
    document.getElementById(modalId).style.display = "none";
    document.body.style.overflow = "auto"; 
}


document.addEventListener('keydown', function(event) {
    if (event.key === 'Escape') {
        const modals = document.querySelectorAll('.image-modal');
        modals.forEach(modal => {
            if (modal.style.display === 'block') {
                modal.style.display = 'none';
                document.body.style.overflow = "auto";
            }
        });
    }
});
</script>

<h2 id="sysmon">Sysmon</h2>
<blockquote>
<p>Note: I&rsquo;am assuming you&rsquo;ve already insatlled ADDS.</p></blockquote>
<p>Sysmon will help us get more event that occurs on a windows endpoint.</p>
<p>You can download sysmon from <a href="https://learn.microsoft.com/en-us/sysinternals/downloads/sysmon">here</a></p>




<div class="clickable-image-container">
    <img src="https://0xprimo.github.io/Active-Directory-Attack-Defense/images/sysmon-download-page.png" 
         alt="Sysmon Download Page"
         width="800"
         
         class="clickable-image"
         onclick="openImageModal('img-9c2dbd5950784c892af96b073b5aa1d5-23')"
         style="cursor: pointer;">
</div>


<div id="img-9c2dbd5950784c892af96b073b5aa1d5-23" class="image-modal" onclick="closeImageModal('img-9c2dbd5950784c892af96b073b5aa1d5-23')">
    <span class="image-modal-close">&times;</span>
    <img class="image-modal-content" src="https://0xprimo.github.io/Active-Directory-Attack-Defense/images/sysmon-download-page.png" alt="Sysmon Download Page">
    <div class="image-modal-caption">Sysmon Download Page</div>
</div>

<style>
.clickable-image {
    transition: opacity 0.3s ease;
}

.clickable-image:hover {
    opacity: 0.8;
}

.image-modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.9);
    animation: fadeIn 0.3s;
}

.image-modal-content {
    margin: auto;
    display: block;
    max-width: 90%;
    max-height: 90%;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    animation: zoomIn 0.3s;
}

.image-modal-close {
    position: absolute;
    top: 15px;
    right: 35px;
    color: #f1f1f1;
    font-size: 40px;
    font-weight: bold;
    cursor: pointer;
    z-index: 1001;
}

.image-modal-close:hover,
.image-modal-close:focus {
    color: #bbb;
    text-decoration: none;
}

.image-modal-caption {
    margin: auto;
    display: block;
    width: 80%;
    max-width: 700px;
    text-align: center;
    color: #ccc;
    padding: 10px 0;
    position: absolute;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes zoomIn {
    from { transform: translate(-50%, -50%) scale(0.5); }
    to { transform: translate(-50%, -50%) scale(1); }
}

@media only screen and (max-width: 700px) {
    .image-modal-content {
        width: 100%;
        max-width: 95%;
        max-height: 95%;
    }
    
    .image-modal-caption {
        font-size: 14px;
        bottom: 10px;
    }
    
    .image-modal-close {
        font-size: 30px;
        top: 10px;
        right: 20px;
    }
}
</style>

<script>
function openImageModal(modalId) {
    document.getElementById(modalId).style.display = "block";
    document.body.style.overflow = "hidden"; 
}

function closeImageModal(modalId) {
    document.getElementById(modalId).style.display = "none";
    document.body.style.overflow = "auto"; 
}


document.addEventListener('keydown', function(event) {
    if (event.key === 'Escape') {
        const modals = document.querySelectorAll('.image-modal');
        modals.forEach(modal => {
            if (modal.style.display === 'block') {
                modal.style.display = 'none';
                document.body.style.overflow = "auto";
            }
        });
    }
});
</script>

<p>in order for sysmon to run it will need a config file in xml format. in the EventFiltering section on the config file we can define custom rules to include or exclude certain events based on conditions (e.g., process name, file path, command line).</p>
<p>for example this rule include events with id 10 (ProcessAccess) base on image name and process access.</p>




<div class="clickable-image-container">
    <img src="https://0xprimo.github.io/Active-Directory-Attack-Defense/images/sysmon-cred-dump-rule.png" 
         alt="Sysmon Credential Dumping Rule Example"
         width="800"
         
         class="clickable-image"
         onclick="openImageModal('img-5797c36cba1b5da1e4b575a19a143737-24')"
         style="cursor: pointer;">
</div>


<div id="img-5797c36cba1b5da1e4b575a19a143737-24" class="image-modal" onclick="closeImageModal('img-5797c36cba1b5da1e4b575a19a143737-24')">
    <span class="image-modal-close">&times;</span>
    <img class="image-modal-content" src="https://0xprimo.github.io/Active-Directory-Attack-Defense/images/sysmon-cred-dump-rule.png" alt="Sysmon Credential Dumping Rule Example">
    <div class="image-modal-caption">Sysmon Credential Dumping Rule Example</div>
</div>

<style>
.clickable-image {
    transition: opacity 0.3s ease;
}

.clickable-image:hover {
    opacity: 0.8;
}

.image-modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.9);
    animation: fadeIn 0.3s;
}

.image-modal-content {
    margin: auto;
    display: block;
    max-width: 90%;
    max-height: 90%;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    animation: zoomIn 0.3s;
}

.image-modal-close {
    position: absolute;
    top: 15px;
    right: 35px;
    color: #f1f1f1;
    font-size: 40px;
    font-weight: bold;
    cursor: pointer;
    z-index: 1001;
}

.image-modal-close:hover,
.image-modal-close:focus {
    color: #bbb;
    text-decoration: none;
}

.image-modal-caption {
    margin: auto;
    display: block;
    width: 80%;
    max-width: 700px;
    text-align: center;
    color: #ccc;
    padding: 10px 0;
    position: absolute;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes zoomIn {
    from { transform: translate(-50%, -50%) scale(0.5); }
    to { transform: translate(-50%, -50%) scale(1); }
}

@media only screen and (max-width: 700px) {
    .image-modal-content {
        width: 100%;
        max-width: 95%;
        max-height: 95%;
    }
    
    .image-modal-caption {
        font-size: 14px;
        bottom: 10px;
    }
    
    .image-modal-close {
        font-size: 30px;
        top: 10px;
        right: 20px;
    }
}
</style>

<script>
function openImageModal(modalId) {
    document.getElementById(modalId).style.display = "block";
    document.body.style.overflow = "hidden"; 
}

function closeImageModal(modalId) {
    document.getElementById(modalId).style.display = "none";
    document.body.style.overflow = "auto"; 
}


document.addEventListener('keydown', function(event) {
    if (event.key === 'Escape') {
        const modals = document.querySelectorAll('.image-modal');
        modals.forEach(modal => {
            if (modal.style.display === 'block') {
                modal.style.display = 'none';
                document.body.style.overflow = "auto";
            }
        });
    }
});
</script>

<p>in this lab setup i&rsquo;ll be using <a href="https://github.com/olafhartong/sysmon-modular/blob/master/sysmonconfig.xml">Olaf Hartong</a> sysmon config. lets now install sysmon.</p>




<div class="clickable-image-container">
    <img src="https://0xprimo.github.io/Active-Directory-Attack-Defense/images/sysmon-installed.png" 
         alt="Sysmon is Insalled"
         width="800"
         
         class="clickable-image"
         onclick="openImageModal('img-6b9c34e7f983f3a42ab23ff382a3565d-25')"
         style="cursor: pointer;">
</div>


<div id="img-6b9c34e7f983f3a42ab23ff382a3565d-25" class="image-modal" onclick="closeImageModal('img-6b9c34e7f983f3a42ab23ff382a3565d-25')">
    <span class="image-modal-close">&times;</span>
    <img class="image-modal-content" src="https://0xprimo.github.io/Active-Directory-Attack-Defense/images/sysmon-installed.png" alt="Sysmon is Insalled">
    <div class="image-modal-caption">Sysmon is Insalled</div>
</div>

<style>
.clickable-image {
    transition: opacity 0.3s ease;
}

.clickable-image:hover {
    opacity: 0.8;
}

.image-modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.9);
    animation: fadeIn 0.3s;
}

.image-modal-content {
    margin: auto;
    display: block;
    max-width: 90%;
    max-height: 90%;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    animation: zoomIn 0.3s;
}

.image-modal-close {
    position: absolute;
    top: 15px;
    right: 35px;
    color: #f1f1f1;
    font-size: 40px;
    font-weight: bold;
    cursor: pointer;
    z-index: 1001;
}

.image-modal-close:hover,
.image-modal-close:focus {
    color: #bbb;
    text-decoration: none;
}

.image-modal-caption {
    margin: auto;
    display: block;
    width: 80%;
    max-width: 700px;
    text-align: center;
    color: #ccc;
    padding: 10px 0;
    position: absolute;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes zoomIn {
    from { transform: translate(-50%, -50%) scale(0.5); }
    to { transform: translate(-50%, -50%) scale(1); }
}

@media only screen and (max-width: 700px) {
    .image-modal-content {
        width: 100%;
        max-width: 95%;
        max-height: 95%;
    }
    
    .image-modal-caption {
        font-size: 14px;
        bottom: 10px;
    }
    
    .image-modal-close {
        font-size: 30px;
        top: 10px;
        right: 20px;
    }
}
</style>

<script>
function openImageModal(modalId) {
    document.getElementById(modalId).style.display = "block";
    document.body.style.overflow = "hidden"; 
}

function closeImageModal(modalId) {
    document.getElementById(modalId).style.display = "none";
    document.body.style.overflow = "auto"; 
}


document.addEventListener('keydown', function(event) {
    if (event.key === 'Escape') {
        const modals = document.querySelectorAll('.image-modal');
        modals.forEach(modal => {
            if (modal.style.display === 'block') {
                modal.style.display = 'none';
                document.body.style.overflow = "auto";
            }
        });
    }
});
</script>

<h2 id="elastic-agent">Elastic Agent</h2>
<p>Elastic Agent is a single, unified way to add monitoring for logs, metrics, and other types of data to hosts. we can install an agent on a host by clicking <code>Add Agent</code> and set a name for policy we want to create.</p>




<div class="clickable-image-container">
    <img src="https://0xprimo.github.io/Active-Directory-Attack-Defense/images/elastic-add-new-agent.png" 
         alt="Add New Agent"
         width="800"
         
         class="clickable-image"
         onclick="openImageModal('img-fe617bdb6736453589b1da25e6838308-26')"
         style="cursor: pointer;">
</div>


<div id="img-fe617bdb6736453589b1da25e6838308-26" class="image-modal" onclick="closeImageModal('img-fe617bdb6736453589b1da25e6838308-26')">
    <span class="image-modal-close">&times;</span>
    <img class="image-modal-content" src="https://0xprimo.github.io/Active-Directory-Attack-Defense/images/elastic-add-new-agent.png" alt="Add New Agent">
    <div class="image-modal-caption">Add New Agent</div>
</div>

<style>
.clickable-image {
    transition: opacity 0.3s ease;
}

.clickable-image:hover {
    opacity: 0.8;
}

.image-modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.9);
    animation: fadeIn 0.3s;
}

.image-modal-content {
    margin: auto;
    display: block;
    max-width: 90%;
    max-height: 90%;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    animation: zoomIn 0.3s;
}

.image-modal-close {
    position: absolute;
    top: 15px;
    right: 35px;
    color: #f1f1f1;
    font-size: 40px;
    font-weight: bold;
    cursor: pointer;
    z-index: 1001;
}

.image-modal-close:hover,
.image-modal-close:focus {
    color: #bbb;
    text-decoration: none;
}

.image-modal-caption {
    margin: auto;
    display: block;
    width: 80%;
    max-width: 700px;
    text-align: center;
    color: #ccc;
    padding: 10px 0;
    position: absolute;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes zoomIn {
    from { transform: translate(-50%, -50%) scale(0.5); }
    to { transform: translate(-50%, -50%) scale(1); }
}

@media only screen and (max-width: 700px) {
    .image-modal-content {
        width: 100%;
        max-width: 95%;
        max-height: 95%;
    }
    
    .image-modal-caption {
        font-size: 14px;
        bottom: 10px;
    }
    
    .image-modal-close {
        font-size: 30px;
        top: 10px;
        right: 20px;
    }
}
</style>

<script>
function openImageModal(modalId) {
    document.getElementById(modalId).style.display = "block";
    document.body.style.overflow = "hidden"; 
}

function closeImageModal(modalId) {
    document.getElementById(modalId).style.display = "none";
    document.body.style.overflow = "auto"; 
}


document.addEventListener('keydown', function(event) {
    if (event.key === 'Escape') {
        const modals = document.querySelectorAll('.image-modal');
        modals.forEach(modal => {
            if (modal.style.display === 'block') {
                modal.style.display = 'none';
                document.body.style.overflow = "auto";
            }
        });
    }
});
</script>

<p>then select <code>Enroll in Fleet</code></p>




<div class="clickable-image-container">
    <img src="https://0xprimo.github.io/Active-Directory-Attack-Defense/images/elastic-select-enroll.png" 
         alt="Select Enroll in Fleet"
         width="800"
         
         class="clickable-image"
         onclick="openImageModal('img-bb9fdc07f2147c142fb9c073e8aa8782-27')"
         style="cursor: pointer;">
</div>


<div id="img-bb9fdc07f2147c142fb9c073e8aa8782-27" class="image-modal" onclick="closeImageModal('img-bb9fdc07f2147c142fb9c073e8aa8782-27')">
    <span class="image-modal-close">&times;</span>
    <img class="image-modal-content" src="https://0xprimo.github.io/Active-Directory-Attack-Defense/images/elastic-select-enroll.png" alt="Select Enroll in Fleet">
    <div class="image-modal-caption">Select Enroll in Fleet</div>
</div>

<style>
.clickable-image {
    transition: opacity 0.3s ease;
}

.clickable-image:hover {
    opacity: 0.8;
}

.image-modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.9);
    animation: fadeIn 0.3s;
}

.image-modal-content {
    margin: auto;
    display: block;
    max-width: 90%;
    max-height: 90%;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    animation: zoomIn 0.3s;
}

.image-modal-close {
    position: absolute;
    top: 15px;
    right: 35px;
    color: #f1f1f1;
    font-size: 40px;
    font-weight: bold;
    cursor: pointer;
    z-index: 1001;
}

.image-modal-close:hover,
.image-modal-close:focus {
    color: #bbb;
    text-decoration: none;
}

.image-modal-caption {
    margin: auto;
    display: block;
    width: 80%;
    max-width: 700px;
    text-align: center;
    color: #ccc;
    padding: 10px 0;
    position: absolute;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes zoomIn {
    from { transform: translate(-50%, -50%) scale(0.5); }
    to { transform: translate(-50%, -50%) scale(1); }
}

@media only screen and (max-width: 700px) {
    .image-modal-content {
        width: 100%;
        max-width: 95%;
        max-height: 95%;
    }
    
    .image-modal-caption {
        font-size: 14px;
        bottom: 10px;
    }
    
    .image-modal-close {
        font-size: 30px;
        top: 10px;
        right: 20px;
    }
}
</style>

<script>
function openImageModal(modalId) {
    document.getElementById(modalId).style.display = "block";
    document.body.style.overflow = "hidden"; 
}

function closeImageModal(modalId) {
    document.getElementById(modalId).style.display = "none";
    document.body.style.overflow = "auto"; 
}


document.addEventListener('keydown', function(event) {
    if (event.key === 'Escape') {
        const modals = document.querySelectorAll('.image-modal');
        modals.forEach(modal => {
            if (modal.style.display === 'block') {
                modal.style.display = 'none';
                document.body.style.overflow = "auto";
            }
        });
    }
});
</script>

<p>select windows then copy and run the command on the domain controller.</p>




<div class="clickable-image-container">
    <img src="https://0xprimo.github.io/Active-Directory-Attack-Defense/images/elastic-select-windows.png" 
         alt="Select Windows"
         width="800"
         
         class="clickable-image"
         onclick="openImageModal('img-7ff33f40b9d0b02f78879c570fc7c6ff-28')"
         style="cursor: pointer;">
</div>


<div id="img-7ff33f40b9d0b02f78879c570fc7c6ff-28" class="image-modal" onclick="closeImageModal('img-7ff33f40b9d0b02f78879c570fc7c6ff-28')">
    <span class="image-modal-close">&times;</span>
    <img class="image-modal-content" src="https://0xprimo.github.io/Active-Directory-Attack-Defense/images/elastic-select-windows.png" alt="Select Windows">
    <div class="image-modal-caption">Select Windows</div>
</div>

<style>
.clickable-image {
    transition: opacity 0.3s ease;
}

.clickable-image:hover {
    opacity: 0.8;
}

.image-modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.9);
    animation: fadeIn 0.3s;
}

.image-modal-content {
    margin: auto;
    display: block;
    max-width: 90%;
    max-height: 90%;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    animation: zoomIn 0.3s;
}

.image-modal-close {
    position: absolute;
    top: 15px;
    right: 35px;
    color: #f1f1f1;
    font-size: 40px;
    font-weight: bold;
    cursor: pointer;
    z-index: 1001;
}

.image-modal-close:hover,
.image-modal-close:focus {
    color: #bbb;
    text-decoration: none;
}

.image-modal-caption {
    margin: auto;
    display: block;
    width: 80%;
    max-width: 700px;
    text-align: center;
    color: #ccc;
    padding: 10px 0;
    position: absolute;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes zoomIn {
    from { transform: translate(-50%, -50%) scale(0.5); }
    to { transform: translate(-50%, -50%) scale(1); }
}

@media only screen and (max-width: 700px) {
    .image-modal-content {
        width: 100%;
        max-width: 95%;
        max-height: 95%;
    }
    
    .image-modal-caption {
        font-size: 14px;
        bottom: 10px;
    }
    
    .image-modal-close {
        font-size: 30px;
        top: 10px;
        right: 20px;
    }
}
</style>

<script>
function openImageModal(modalId) {
    document.getElementById(modalId).style.display = "block";
    document.body.style.overflow = "hidden"; 
}

function closeImageModal(modalId) {
    document.getElementById(modalId).style.display = "none";
    document.body.style.overflow = "auto"; 
}


document.addEventListener('keydown', function(event) {
    if (event.key === 'Escape') {
        const modals = document.querySelectorAll('.image-modal');
        modals.forEach(modal => {
            if (modal.style.display === 'block') {
                modal.style.display = 'none';
                document.body.style.overflow = "auto";
            }
        });
    }
});
</script>

<p>One thing to add is you&rsquo;ll need to add <code>--insecure</code> to the last command to ignore self-signed certificate warnings.</p>




<div class="clickable-image-container">
    <img src="https://0xprimo.github.io/Active-Directory-Attack-Defense/images/insecure-flag-before-installing.png" 
         alt="Select Windows"
         width="800"
         
         class="clickable-image"
         onclick="openImageModal('img-5be93e55fc25906c5de52cc6d390931d-29')"
         style="cursor: pointer;">
</div>


<div id="img-5be93e55fc25906c5de52cc6d390931d-29" class="image-modal" onclick="closeImageModal('img-5be93e55fc25906c5de52cc6d390931d-29')">
    <span class="image-modal-close">&times;</span>
    <img class="image-modal-content" src="https://0xprimo.github.io/Active-Directory-Attack-Defense/images/insecure-flag-before-installing.png" alt="Select Windows">
    <div class="image-modal-caption">Select Windows</div>
</div>

<style>
.clickable-image {
    transition: opacity 0.3s ease;
}

.clickable-image:hover {
    opacity: 0.8;
}

.image-modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.9);
    animation: fadeIn 0.3s;
}

.image-modal-content {
    margin: auto;
    display: block;
    max-width: 90%;
    max-height: 90%;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    animation: zoomIn 0.3s;
}

.image-modal-close {
    position: absolute;
    top: 15px;
    right: 35px;
    color: #f1f1f1;
    font-size: 40px;
    font-weight: bold;
    cursor: pointer;
    z-index: 1001;
}

.image-modal-close:hover,
.image-modal-close:focus {
    color: #bbb;
    text-decoration: none;
}

.image-modal-caption {
    margin: auto;
    display: block;
    width: 80%;
    max-width: 700px;
    text-align: center;
    color: #ccc;
    padding: 10px 0;
    position: absolute;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes zoomIn {
    from { transform: translate(-50%, -50%) scale(0.5); }
    to { transform: translate(-50%, -50%) scale(1); }
}

@media only screen and (max-width: 700px) {
    .image-modal-content {
        width: 100%;
        max-width: 95%;
        max-height: 95%;
    }
    
    .image-modal-caption {
        font-size: 14px;
        bottom: 10px;
    }
    
    .image-modal-close {
        font-size: 30px;
        top: 10px;
        right: 20px;
    }
}
</style>

<script>
function openImageModal(modalId) {
    document.getElementById(modalId).style.display = "block";
    document.body.style.overflow = "hidden"; 
}

function closeImageModal(modalId) {
    document.getElementById(modalId).style.display = "none";
    document.body.style.overflow = "auto"; 
}


document.addEventListener('keydown', function(event) {
    if (event.key === 'Escape') {
        const modals = document.querySelectorAll('.image-modal');
        modals.forEach(modal => {
            if (modal.style.display === 'block') {
                modal.style.display = 'none';
                document.body.style.overflow = "auto";
            }
        });
    }
});
</script>

<p>once the installation is finished we can see that DC01 is added to agents in our dashboard</p>




<div class="clickable-image-container">
    <img src="https://0xprimo.github.io/Active-Directory-Attack-Defense/images/elastic-agent-dc01-status.png" 
         alt="DC01 status"
         width="800"
         
         class="clickable-image"
         onclick="openImageModal('img-d76564d64e13f3cbc7630c95635b2dc7-30')"
         style="cursor: pointer;">
</div>


<div id="img-d76564d64e13f3cbc7630c95635b2dc7-30" class="image-modal" onclick="closeImageModal('img-d76564d64e13f3cbc7630c95635b2dc7-30')">
    <span class="image-modal-close">&times;</span>
    <img class="image-modal-content" src="https://0xprimo.github.io/Active-Directory-Attack-Defense/images/elastic-agent-dc01-status.png" alt="DC01 status">
    <div class="image-modal-caption">DC01 status</div>
</div>

<style>
.clickable-image {
    transition: opacity 0.3s ease;
}

.clickable-image:hover {
    opacity: 0.8;
}

.image-modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.9);
    animation: fadeIn 0.3s;
}

.image-modal-content {
    margin: auto;
    display: block;
    max-width: 90%;
    max-height: 90%;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    animation: zoomIn 0.3s;
}

.image-modal-close {
    position: absolute;
    top: 15px;
    right: 35px;
    color: #f1f1f1;
    font-size: 40px;
    font-weight: bold;
    cursor: pointer;
    z-index: 1001;
}

.image-modal-close:hover,
.image-modal-close:focus {
    color: #bbb;
    text-decoration: none;
}

.image-modal-caption {
    margin: auto;
    display: block;
    width: 80%;
    max-width: 700px;
    text-align: center;
    color: #ccc;
    padding: 10px 0;
    position: absolute;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes zoomIn {
    from { transform: translate(-50%, -50%) scale(0.5); }
    to { transform: translate(-50%, -50%) scale(1); }
}

@media only screen and (max-width: 700px) {
    .image-modal-content {
        width: 100%;
        max-width: 95%;
        max-height: 95%;
    }
    
    .image-modal-caption {
        font-size: 14px;
        bottom: 10px;
    }
    
    .image-modal-close {
        font-size: 30px;
        top: 10px;
        right: 20px;
    }
}
</style>

<script>
function openImageModal(modalId) {
    document.getElementById(modalId).style.display = "block";
    document.body.style.overflow = "hidden"; 
}

function closeImageModal(modalId) {
    document.getElementById(modalId).style.display = "none";
    document.body.style.overflow = "auto"; 
}


document.addEventListener('keydown', function(event) {
    if (event.key === 'Escape') {
        const modals = document.querySelectorAll('.image-modal');
        modals.forEach(modal => {
            if (modal.style.display === 'block') {
                modal.style.display = 'none';
                document.body.style.overflow = "auto";
            }
        });
    }
});
</script>

<h2 id="ingesting-sysmon-and-windows-defender-logs">Ingesting Sysmon and Windows Defender logs</h2>
<p>One last step to finish this lab setup is ingesting sysmon and windows defender logs into elasticsearch. first will add new integration by going to <code>Management -&gt; Integration</code> page.</p>




<div class="clickable-image-container">
    <img src="https://0xprimo.github.io/Active-Directory-Attack-Defense/images/kibana-add-integration.png" 
         alt="Goto Integration"
         width="800"
         
         class="clickable-image"
         onclick="openImageModal('img-7310f7c2acbe56f6438822a4d678a240-31')"
         style="cursor: pointer;">
</div>


<div id="img-7310f7c2acbe56f6438822a4d678a240-31" class="image-modal" onclick="closeImageModal('img-7310f7c2acbe56f6438822a4d678a240-31')">
    <span class="image-modal-close">&times;</span>
    <img class="image-modal-content" src="https://0xprimo.github.io/Active-Directory-Attack-Defense/images/kibana-add-integration.png" alt="Goto Integration">
    <div class="image-modal-caption">Goto Integration</div>
</div>

<style>
.clickable-image {
    transition: opacity 0.3s ease;
}

.clickable-image:hover {
    opacity: 0.8;
}

.image-modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.9);
    animation: fadeIn 0.3s;
}

.image-modal-content {
    margin: auto;
    display: block;
    max-width: 90%;
    max-height: 90%;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    animation: zoomIn 0.3s;
}

.image-modal-close {
    position: absolute;
    top: 15px;
    right: 35px;
    color: #f1f1f1;
    font-size: 40px;
    font-weight: bold;
    cursor: pointer;
    z-index: 1001;
}

.image-modal-close:hover,
.image-modal-close:focus {
    color: #bbb;
    text-decoration: none;
}

.image-modal-caption {
    margin: auto;
    display: block;
    width: 80%;
    max-width: 700px;
    text-align: center;
    color: #ccc;
    padding: 10px 0;
    position: absolute;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes zoomIn {
    from { transform: translate(-50%, -50%) scale(0.5); }
    to { transform: translate(-50%, -50%) scale(1); }
}

@media only screen and (max-width: 700px) {
    .image-modal-content {
        width: 100%;
        max-width: 95%;
        max-height: 95%;
    }
    
    .image-modal-caption {
        font-size: 14px;
        bottom: 10px;
    }
    
    .image-modal-close {
        font-size: 30px;
        top: 10px;
        right: 20px;
    }
}
</style>

<script>
function openImageModal(modalId) {
    document.getElementById(modalId).style.display = "block";
    document.body.style.overflow = "hidden"; 
}

function closeImageModal(modalId) {
    document.getElementById(modalId).style.display = "none";
    document.body.style.overflow = "auto"; 
}


document.addEventListener('keydown', function(event) {
    if (event.key === 'Escape') {
        const modals = document.querySelectorAll('.image-modal');
        modals.forEach(modal => {
            if (modal.style.display === 'block') {
                modal.style.display = 'none';
                document.body.style.overflow = "auto";
            }
        });
    }
});
</script>

<p>then search fro <code>Custom Windows Event Logs</code>.</p>




<div class="clickable-image-container">
    <img src="https://0xprimo.github.io/Active-Directory-Attack-Defense/images/kibana-custom-windows-integration.png" 
         alt="Search for &#39;Custom Windows Event Logs&#39;"
         width="800"
         
         class="clickable-image"
         onclick="openImageModal('img-2cac86c8ab2fe0a7cbcf9e4c15653906-32')"
         style="cursor: pointer;">
</div>


<div id="img-2cac86c8ab2fe0a7cbcf9e4c15653906-32" class="image-modal" onclick="closeImageModal('img-2cac86c8ab2fe0a7cbcf9e4c15653906-32')">
    <span class="image-modal-close">&times;</span>
    <img class="image-modal-content" src="https://0xprimo.github.io/Active-Directory-Attack-Defense/images/kibana-custom-windows-integration.png" alt="Search for &#39;Custom Windows Event Logs&#39;">
    <div class="image-modal-caption">Search for &#39;Custom Windows Event Logs&#39;</div>
</div>

<style>
.clickable-image {
    transition: opacity 0.3s ease;
}

.clickable-image:hover {
    opacity: 0.8;
}

.image-modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.9);
    animation: fadeIn 0.3s;
}

.image-modal-content {
    margin: auto;
    display: block;
    max-width: 90%;
    max-height: 90%;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    animation: zoomIn 0.3s;
}

.image-modal-close {
    position: absolute;
    top: 15px;
    right: 35px;
    color: #f1f1f1;
    font-size: 40px;
    font-weight: bold;
    cursor: pointer;
    z-index: 1001;
}

.image-modal-close:hover,
.image-modal-close:focus {
    color: #bbb;
    text-decoration: none;
}

.image-modal-caption {
    margin: auto;
    display: block;
    width: 80%;
    max-width: 700px;
    text-align: center;
    color: #ccc;
    padding: 10px 0;
    position: absolute;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes zoomIn {
    from { transform: translate(-50%, -50%) scale(0.5); }
    to { transform: translate(-50%, -50%) scale(1); }
}

@media only screen and (max-width: 700px) {
    .image-modal-content {
        width: 100%;
        max-width: 95%;
        max-height: 95%;
    }
    
    .image-modal-caption {
        font-size: 14px;
        bottom: 10px;
    }
    
    .image-modal-close {
        font-size: 30px;
        top: 10px;
        right: 20px;
    }
}
</style>

<script>
function openImageModal(modalId) {
    document.getElementById(modalId).style.display = "block";
    document.body.style.overflow = "hidden"; 
}

function closeImageModal(modalId) {
    document.getElementById(modalId).style.display = "none";
    document.body.style.overflow = "auto"; 
}


document.addEventListener('keydown', function(event) {
    if (event.key === 'Escape') {
        const modals = document.querySelectorAll('.image-modal');
        modals.forEach(modal => {
            if (modal.style.display === 'block') {
                modal.style.display = 'none';
                document.body.style.overflow = "auto";
            }
        });
    }
});
</script>

<p>click on <code>Add Custom Windows Event Logs</code></p>




<div class="clickable-image-container">
    <img src="https://0xprimo.github.io/Active-Directory-Attack-Defense/images/kibana-integration-page.png" 
         alt="Custom Windows Event Logs Integration"
         width="800"
         
         class="clickable-image"
         onclick="openImageModal('img-ed7bf22da3581202d17b7a9e6bf12cb3-33')"
         style="cursor: pointer;">
</div>


<div id="img-ed7bf22da3581202d17b7a9e6bf12cb3-33" class="image-modal" onclick="closeImageModal('img-ed7bf22da3581202d17b7a9e6bf12cb3-33')">
    <span class="image-modal-close">&times;</span>
    <img class="image-modal-content" src="https://0xprimo.github.io/Active-Directory-Attack-Defense/images/kibana-integration-page.png" alt="Custom Windows Event Logs Integration">
    <div class="image-modal-caption">Custom Windows Event Logs Integration</div>
</div>

<style>
.clickable-image {
    transition: opacity 0.3s ease;
}

.clickable-image:hover {
    opacity: 0.8;
}

.image-modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.9);
    animation: fadeIn 0.3s;
}

.image-modal-content {
    margin: auto;
    display: block;
    max-width: 90%;
    max-height: 90%;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    animation: zoomIn 0.3s;
}

.image-modal-close {
    position: absolute;
    top: 15px;
    right: 35px;
    color: #f1f1f1;
    font-size: 40px;
    font-weight: bold;
    cursor: pointer;
    z-index: 1001;
}

.image-modal-close:hover,
.image-modal-close:focus {
    color: #bbb;
    text-decoration: none;
}

.image-modal-caption {
    margin: auto;
    display: block;
    width: 80%;
    max-width: 700px;
    text-align: center;
    color: #ccc;
    padding: 10px 0;
    position: absolute;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes zoomIn {
    from { transform: translate(-50%, -50%) scale(0.5); }
    to { transform: translate(-50%, -50%) scale(1); }
}

@media only screen and (max-width: 700px) {
    .image-modal-content {
        width: 100%;
        max-width: 95%;
        max-height: 95%;
    }
    
    .image-modal-caption {
        font-size: 14px;
        bottom: 10px;
    }
    
    .image-modal-close {
        font-size: 30px;
        top: 10px;
        right: 20px;
    }
}
</style>

<script>
function openImageModal(modalId) {
    document.getElementById(modalId).style.display = "block";
    document.body.style.overflow = "hidden"; 
}

function closeImageModal(modalId) {
    document.getElementById(modalId).style.display = "none";
    document.body.style.overflow = "auto"; 
}


document.addEventListener('keydown', function(event) {
    if (event.key === 'Escape') {
        const modals = document.querySelectorAll('.image-modal');
        modals.forEach(modal => {
            if (modal.style.display === 'block') {
                modal.style.display = 'none';
                document.body.style.overflow = "auto";
            }
        });
    }
});
</script>

<p>fill the integration configuration.</p>




<div class="clickable-image-container">
    <img src="https://0xprimo.github.io/Active-Directory-Attack-Defense/images/kibana-integration-config-dc01.png" 
         alt="DC01 Custom Windows Event Logs Integration Config"
         width="800"
         
         class="clickable-image"
         onclick="openImageModal('img-253648fbb00b3ab6888cfc19167c9625-34')"
         style="cursor: pointer;">
</div>


<div id="img-253648fbb00b3ab6888cfc19167c9625-34" class="image-modal" onclick="closeImageModal('img-253648fbb00b3ab6888cfc19167c9625-34')">
    <span class="image-modal-close">&times;</span>
    <img class="image-modal-content" src="https://0xprimo.github.io/Active-Directory-Attack-Defense/images/kibana-integration-config-dc01.png" alt="DC01 Custom Windows Event Logs Integration Config">
    <div class="image-modal-caption">DC01 Custom Windows Event Logs Integration Config</div>
</div>

<style>
.clickable-image {
    transition: opacity 0.3s ease;
}

.clickable-image:hover {
    opacity: 0.8;
}

.image-modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.9);
    animation: fadeIn 0.3s;
}

.image-modal-content {
    margin: auto;
    display: block;
    max-width: 90%;
    max-height: 90%;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    animation: zoomIn 0.3s;
}

.image-modal-close {
    position: absolute;
    top: 15px;
    right: 35px;
    color: #f1f1f1;
    font-size: 40px;
    font-weight: bold;
    cursor: pointer;
    z-index: 1001;
}

.image-modal-close:hover,
.image-modal-close:focus {
    color: #bbb;
    text-decoration: none;
}

.image-modal-caption {
    margin: auto;
    display: block;
    width: 80%;
    max-width: 700px;
    text-align: center;
    color: #ccc;
    padding: 10px 0;
    position: absolute;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes zoomIn {
    from { transform: translate(-50%, -50%) scale(0.5); }
    to { transform: translate(-50%, -50%) scale(1); }
}

@media only screen and (max-width: 700px) {
    .image-modal-content {
        width: 100%;
        max-width: 95%;
        max-height: 95%;
    }
    
    .image-modal-caption {
        font-size: 14px;
        bottom: 10px;
    }
    
    .image-modal-close {
        font-size: 30px;
        top: 10px;
        right: 20px;
    }
}
</style>

<script>
function openImageModal(modalId) {
    document.getElementById(modalId).style.display = "block";
    document.body.style.overflow = "hidden"; 
}

function closeImageModal(modalId) {
    document.getElementById(modalId).style.display = "none";
    document.body.style.overflow = "auto"; 
}


document.addEventListener('keydown', function(event) {
    if (event.key === 'Escape') {
        const modals = document.querySelectorAll('.image-modal');
        modals.forEach(modal => {
            if (modal.style.display === 'block') {
                modal.style.display = 'none';
                document.body.style.overflow = "auto";
            }
        });
    }
});
</script>

<p>select hosts to apply the integration to.</p>




<div class="clickable-image-container">
    <img src="https://0xprimo.github.io/Active-Directory-Attack-Defense/images/kibana-select-host-to-apply-integration.png" 
         alt="Select Hosts to apply policy to"
         width="800"
         
         class="clickable-image"
         onclick="openImageModal('img-36a679b6b062292d93d84200decbf83b-35')"
         style="cursor: pointer;">
</div>


<div id="img-36a679b6b062292d93d84200decbf83b-35" class="image-modal" onclick="closeImageModal('img-36a679b6b062292d93d84200decbf83b-35')">
    <span class="image-modal-close">&times;</span>
    <img class="image-modal-content" src="https://0xprimo.github.io/Active-Directory-Attack-Defense/images/kibana-select-host-to-apply-integration.png" alt="Select Hosts to apply policy to">
    <div class="image-modal-caption">Select Hosts to apply policy to</div>
</div>

<style>
.clickable-image {
    transition: opacity 0.3s ease;
}

.clickable-image:hover {
    opacity: 0.8;
}

.image-modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.9);
    animation: fadeIn 0.3s;
}

.image-modal-content {
    margin: auto;
    display: block;
    max-width: 90%;
    max-height: 90%;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    animation: zoomIn 0.3s;
}

.image-modal-close {
    position: absolute;
    top: 15px;
    right: 35px;
    color: #f1f1f1;
    font-size: 40px;
    font-weight: bold;
    cursor: pointer;
    z-index: 1001;
}

.image-modal-close:hover,
.image-modal-close:focus {
    color: #bbb;
    text-decoration: none;
}

.image-modal-caption {
    margin: auto;
    display: block;
    width: 80%;
    max-width: 700px;
    text-align: center;
    color: #ccc;
    padding: 10px 0;
    position: absolute;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes zoomIn {
    from { transform: translate(-50%, -50%) scale(0.5); }
    to { transform: translate(-50%, -50%) scale(1); }
}

@media only screen and (max-width: 700px) {
    .image-modal-content {
        width: 100%;
        max-width: 95%;
        max-height: 95%;
    }
    
    .image-modal-caption {
        font-size: 14px;
        bottom: 10px;
    }
    
    .image-modal-close {
        font-size: 30px;
        top: 10px;
        right: 20px;
    }
}
</style>

<script>
function openImageModal(modalId) {
    document.getElementById(modalId).style.display = "block";
    document.body.style.overflow = "hidden"; 
}

function closeImageModal(modalId) {
    document.getElementById(modalId).style.display = "none";
    document.body.style.overflow = "auto"; 
}


document.addEventListener('keydown', function(event) {
    if (event.key === 'Escape') {
        const modals = document.querySelectorAll('.image-modal');
        modals.forEach(modal => {
            if (modal.style.display === 'block') {
                modal.style.display = 'none';
                document.body.style.overflow = "auto";
            }
        });
    }
});
</script>

<p>then click on <code>Save and continue</code>.</p>
<p>we also need to add windows defender logs. set channel name to <code>Microsoft-Windows-Windows Defender/Operational</code>.</p>




<div class="clickable-image-container">
    <img src="https://0xprimo.github.io/Active-Directory-Attack-Defense/images/kibana-integration-defender.png" 
         alt="Add Itegration for Windows Defender logs collection"
         width="800"
         
         class="clickable-image"
         onclick="openImageModal('img-b06e4e134d82190d68f96c2f0a422286-36')"
         style="cursor: pointer;">
</div>


<div id="img-b06e4e134d82190d68f96c2f0a422286-36" class="image-modal" onclick="closeImageModal('img-b06e4e134d82190d68f96c2f0a422286-36')">
    <span class="image-modal-close">&times;</span>
    <img class="image-modal-content" src="https://0xprimo.github.io/Active-Directory-Attack-Defense/images/kibana-integration-defender.png" alt="Add Itegration for Windows Defender logs collection">
    <div class="image-modal-caption">Add Itegration for Windows Defender logs collection</div>
</div>

<style>
.clickable-image {
    transition: opacity 0.3s ease;
}

.clickable-image:hover {
    opacity: 0.8;
}

.image-modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.9);
    animation: fadeIn 0.3s;
}

.image-modal-content {
    margin: auto;
    display: block;
    max-width: 90%;
    max-height: 90%;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    animation: zoomIn 0.3s;
}

.image-modal-close {
    position: absolute;
    top: 15px;
    right: 35px;
    color: #f1f1f1;
    font-size: 40px;
    font-weight: bold;
    cursor: pointer;
    z-index: 1001;
}

.image-modal-close:hover,
.image-modal-close:focus {
    color: #bbb;
    text-decoration: none;
}

.image-modal-caption {
    margin: auto;
    display: block;
    width: 80%;
    max-width: 700px;
    text-align: center;
    color: #ccc;
    padding: 10px 0;
    position: absolute;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes zoomIn {
    from { transform: translate(-50%, -50%) scale(0.5); }
    to { transform: translate(-50%, -50%) scale(1); }
}

@media only screen and (max-width: 700px) {
    .image-modal-content {
        width: 100%;
        max-width: 95%;
        max-height: 95%;
    }
    
    .image-modal-caption {
        font-size: 14px;
        bottom: 10px;
    }
    
    .image-modal-close {
        font-size: 30px;
        top: 10px;
        right: 20px;
    }
}
</style>

<script>
function openImageModal(modalId) {
    document.getElementById(modalId).style.display = "block";
    document.body.style.overflow = "hidden"; 
}

function closeImageModal(modalId) {
    document.getElementById(modalId).style.display = "none";
    document.body.style.overflow = "auto"; 
}


document.addEventListener('keydown', function(event) {
    if (event.key === 'Escape') {
        const modals = document.querySelectorAll('.image-modal');
        modals.forEach(modal => {
            if (modal.style.display === 'block') {
                modal.style.display = 'none';
                document.body.style.overflow = "auto";
            }
        });
    }
});
</script>

<p>for windows defender logs we only want to include the events 1116 (MALWAREPROTECTION_STATE_MALWARE_DETECTED), 1117 (MALWAREPROTECTION_STATE_MALWARE_ACTION_TAKEN) and 5001 (MALWAREPROTECTION_RTP_DISABLED). to do this we click on advance options and add those event IDs.</p>




<div class="clickable-image-container">
    <img src="https://0xprimo.github.io/Active-Directory-Attack-Defense/images/kibana-defender-include-events.png" 
         alt="Include Windows Defender Events"
         width="800"
         
         class="clickable-image"
         onclick="openImageModal('img-90d3ecec5b0a78643d74879b11fb2e12-37')"
         style="cursor: pointer;">
</div>


<div id="img-90d3ecec5b0a78643d74879b11fb2e12-37" class="image-modal" onclick="closeImageModal('img-90d3ecec5b0a78643d74879b11fb2e12-37')">
    <span class="image-modal-close">&times;</span>
    <img class="image-modal-content" src="https://0xprimo.github.io/Active-Directory-Attack-Defense/images/kibana-defender-include-events.png" alt="Include Windows Defender Events">
    <div class="image-modal-caption">Include Windows Defender Events</div>
</div>

<style>
.clickable-image {
    transition: opacity 0.3s ease;
}

.clickable-image:hover {
    opacity: 0.8;
}

.image-modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.9);
    animation: fadeIn 0.3s;
}

.image-modal-content {
    margin: auto;
    display: block;
    max-width: 90%;
    max-height: 90%;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    animation: zoomIn 0.3s;
}

.image-modal-close {
    position: absolute;
    top: 15px;
    right: 35px;
    color: #f1f1f1;
    font-size: 40px;
    font-weight: bold;
    cursor: pointer;
    z-index: 1001;
}

.image-modal-close:hover,
.image-modal-close:focus {
    color: #bbb;
    text-decoration: none;
}

.image-modal-caption {
    margin: auto;
    display: block;
    width: 80%;
    max-width: 700px;
    text-align: center;
    color: #ccc;
    padding: 10px 0;
    position: absolute;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes zoomIn {
    from { transform: translate(-50%, -50%) scale(0.5); }
    to { transform: translate(-50%, -50%) scale(1); }
}

@media only screen and (max-width: 700px) {
    .image-modal-content {
        width: 100%;
        max-width: 95%;
        max-height: 95%;
    }
    
    .image-modal-caption {
        font-size: 14px;
        bottom: 10px;
    }
    
    .image-modal-close {
        font-size: 30px;
        top: 10px;
        right: 20px;
    }
}
</style>

<script>
function openImageModal(modalId) {
    document.getElementById(modalId).style.display = "block";
    document.body.style.overflow = "hidden"; 
}

function closeImageModal(modalId) {
    document.getElementById(modalId).style.display = "none";
    document.body.style.overflow = "auto"; 
}


document.addEventListener('keydown', function(event) {
    if (event.key === 'Escape') {
        const modals = document.querySelectorAll('.image-modal');
        modals.forEach(modal => {
            if (modal.style.display === 'block') {
                modal.style.display = 'none';
                document.body.style.overflow = "auto";
            }
        });
    }
});
</script>

<p>then we select the hosts we want add integration to and click on <code>Save and continue</code></p>




<div class="clickable-image-container">
    <img src="https://0xprimo.github.io/Active-Directory-Attack-Defense/images/kibana-add-itegration-to-dc01.png" 
         alt="Include Windows Defender Events"
         width="800"
         
         class="clickable-image"
         onclick="openImageModal('img-418d5a34f89ed206909669accd2286f6-38')"
         style="cursor: pointer;">
</div>


<div id="img-418d5a34f89ed206909669accd2286f6-38" class="image-modal" onclick="closeImageModal('img-418d5a34f89ed206909669accd2286f6-38')">
    <span class="image-modal-close">&times;</span>
    <img class="image-modal-content" src="https://0xprimo.github.io/Active-Directory-Attack-Defense/images/kibana-add-itegration-to-dc01.png" alt="Include Windows Defender Events">
    <div class="image-modal-caption">Include Windows Defender Events</div>
</div>

<style>
.clickable-image {
    transition: opacity 0.3s ease;
}

.clickable-image:hover {
    opacity: 0.8;
}

.image-modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.9);
    animation: fadeIn 0.3s;
}

.image-modal-content {
    margin: auto;
    display: block;
    max-width: 90%;
    max-height: 90%;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    animation: zoomIn 0.3s;
}

.image-modal-close {
    position: absolute;
    top: 15px;
    right: 35px;
    color: #f1f1f1;
    font-size: 40px;
    font-weight: bold;
    cursor: pointer;
    z-index: 1001;
}

.image-modal-close:hover,
.image-modal-close:focus {
    color: #bbb;
    text-decoration: none;
}

.image-modal-caption {
    margin: auto;
    display: block;
    width: 80%;
    max-width: 700px;
    text-align: center;
    color: #ccc;
    padding: 10px 0;
    position: absolute;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes zoomIn {
    from { transform: translate(-50%, -50%) scale(0.5); }
    to { transform: translate(-50%, -50%) scale(1); }
}

@media only screen and (max-width: 700px) {
    .image-modal-content {
        width: 100%;
        max-width: 95%;
        max-height: 95%;
    }
    
    .image-modal-caption {
        font-size: 14px;
        bottom: 10px;
    }
    
    .image-modal-close {
        font-size: 30px;
        top: 10px;
        right: 20px;
    }
}
</style>

<script>
function openImageModal(modalId) {
    document.getElementById(modalId).style.display = "block";
    document.body.style.overflow = "hidden"; 
}

function closeImageModal(modalId) {
    document.getElementById(modalId).style.display = "none";
    document.body.style.overflow = "auto"; 
}


document.addEventListener('keydown', function(event) {
    if (event.key === 'Escape') {
        const modals = document.querySelectorAll('.image-modal');
        modals.forEach(modal => {
            if (modal.style.display === 'block') {
                modal.style.display = 'none';
                document.body.style.overflow = "auto";
            }
        });
    }
});
</script>

<h2 id="testing-our-lab">Testing our lab</h2>
<h3 id="sysmon-1">Sysmon</h3>
<p>to confirm that sysmon logs are been ingested into elasticsearch lets run the command <code>whoami.exe</code>.</p>




<div class="clickable-image-container">
    <img src="https://0xprimo.github.io/Active-Directory-Attack-Defense/images/lab-setup-test-1.png" 
         alt="Running whoami.exe"
         width="800"
         
         class="clickable-image"
         onclick="openImageModal('img-61a37b81d5c208eb61217c9532f7508d-39')"
         style="cursor: pointer;">
</div>


<div id="img-61a37b81d5c208eb61217c9532f7508d-39" class="image-modal" onclick="closeImageModal('img-61a37b81d5c208eb61217c9532f7508d-39')">
    <span class="image-modal-close">&times;</span>
    <img class="image-modal-content" src="https://0xprimo.github.io/Active-Directory-Attack-Defense/images/lab-setup-test-1.png" alt="Running whoami.exe">
    <div class="image-modal-caption">Running whoami.exe</div>
</div>

<style>
.clickable-image {
    transition: opacity 0.3s ease;
}

.clickable-image:hover {
    opacity: 0.8;
}

.image-modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.9);
    animation: fadeIn 0.3s;
}

.image-modal-content {
    margin: auto;
    display: block;
    max-width: 90%;
    max-height: 90%;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    animation: zoomIn 0.3s;
}

.image-modal-close {
    position: absolute;
    top: 15px;
    right: 35px;
    color: #f1f1f1;
    font-size: 40px;
    font-weight: bold;
    cursor: pointer;
    z-index: 1001;
}

.image-modal-close:hover,
.image-modal-close:focus {
    color: #bbb;
    text-decoration: none;
}

.image-modal-caption {
    margin: auto;
    display: block;
    width: 80%;
    max-width: 700px;
    text-align: center;
    color: #ccc;
    padding: 10px 0;
    position: absolute;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes zoomIn {
    from { transform: translate(-50%, -50%) scale(0.5); }
    to { transform: translate(-50%, -50%) scale(1); }
}

@media only screen and (max-width: 700px) {
    .image-modal-content {
        width: 100%;
        max-width: 95%;
        max-height: 95%;
    }
    
    .image-modal-caption {
        font-size: 14px;
        bottom: 10px;
    }
    
    .image-modal-close {
        font-size: 30px;
        top: 10px;
        right: 20px;
    }
}
</style>

<script>
function openImageModal(modalId) {
    document.getElementById(modalId).style.display = "block";
    document.body.style.overflow = "hidden"; 
}

function closeImageModal(modalId) {
    document.getElementById(modalId).style.display = "none";
    document.body.style.overflow = "auto"; 
}


document.addEventListener('keydown', function(event) {
    if (event.key === 'Escape') {
        const modals = document.querySelectorAll('.image-modal');
        modals.forEach(modal => {
            if (modal.style.display === 'block') {
                modal.style.display = 'none';
                document.body.style.overflow = "auto";
            }
        });
    }
});
</script>

<p>now let&rsquo;s use the following filter <code>winlog.event_id:&quot;1&quot; and winlog.event_data.CommandLine:*whoami*</code></p>




<div class="clickable-image-container">
    <img src="https://0xprimo.github.io/Active-Directory-Attack-Defense/images/lab-setup-test-1-1.png" 
         alt="Search filter"
         width="800"
         
         class="clickable-image"
         onclick="openImageModal('img-d2764c7fbe5a1f119c5bc56dbdc70b8d-40')"
         style="cursor: pointer;">
</div>


<div id="img-d2764c7fbe5a1f119c5bc56dbdc70b8d-40" class="image-modal" onclick="closeImageModal('img-d2764c7fbe5a1f119c5bc56dbdc70b8d-40')">
    <span class="image-modal-close">&times;</span>
    <img class="image-modal-content" src="https://0xprimo.github.io/Active-Directory-Attack-Defense/images/lab-setup-test-1-1.png" alt="Search filter">
    <div class="image-modal-caption">Search filter</div>
</div>

<style>
.clickable-image {
    transition: opacity 0.3s ease;
}

.clickable-image:hover {
    opacity: 0.8;
}

.image-modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.9);
    animation: fadeIn 0.3s;
}

.image-modal-content {
    margin: auto;
    display: block;
    max-width: 90%;
    max-height: 90%;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    animation: zoomIn 0.3s;
}

.image-modal-close {
    position: absolute;
    top: 15px;
    right: 35px;
    color: #f1f1f1;
    font-size: 40px;
    font-weight: bold;
    cursor: pointer;
    z-index: 1001;
}

.image-modal-close:hover,
.image-modal-close:focus {
    color: #bbb;
    text-decoration: none;
}

.image-modal-caption {
    margin: auto;
    display: block;
    width: 80%;
    max-width: 700px;
    text-align: center;
    color: #ccc;
    padding: 10px 0;
    position: absolute;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes zoomIn {
    from { transform: translate(-50%, -50%) scale(0.5); }
    to { transform: translate(-50%, -50%) scale(1); }
}

@media only screen and (max-width: 700px) {
    .image-modal-content {
        width: 100%;
        max-width: 95%;
        max-height: 95%;
    }
    
    .image-modal-caption {
        font-size: 14px;
        bottom: 10px;
    }
    
    .image-modal-close {
        font-size: 30px;
        top: 10px;
        right: 20px;
    }
}
</style>

<script>
function openImageModal(modalId) {
    document.getElementById(modalId).style.display = "block";
    document.body.style.overflow = "hidden"; 
}

function closeImageModal(modalId) {
    document.getElementById(modalId).style.display = "none";
    document.body.style.overflow = "auto"; 
}


document.addEventListener('keydown', function(event) {
    if (event.key === 'Escape') {
        const modals = document.querySelectorAll('.image-modal');
        modals.forEach(modal => {
            if (modal.style.display === 'block') {
                modal.style.display = 'none';
                document.body.style.overflow = "auto";
            }
        });
    }
});
</script>

<p>we can confirm that this log came from sysmon by viewing <code>event.provider</code></p>




<div class="clickable-image-container">
    <img src="https://0xprimo.github.io/Active-Directory-Attack-Defense/images/lab-setup-test-1-2.png" 
         alt="Checking log provider"
         width="800"
         
         class="clickable-image"
         onclick="openImageModal('img-edc2d12fe25a1f71b4856601c164d718-41')"
         style="cursor: pointer;">
</div>


<div id="img-edc2d12fe25a1f71b4856601c164d718-41" class="image-modal" onclick="closeImageModal('img-edc2d12fe25a1f71b4856601c164d718-41')">
    <span class="image-modal-close">&times;</span>
    <img class="image-modal-content" src="https://0xprimo.github.io/Active-Directory-Attack-Defense/images/lab-setup-test-1-2.png" alt="Checking log provider">
    <div class="image-modal-caption">Checking log provider</div>
</div>

<style>
.clickable-image {
    transition: opacity 0.3s ease;
}

.clickable-image:hover {
    opacity: 0.8;
}

.image-modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.9);
    animation: fadeIn 0.3s;
}

.image-modal-content {
    margin: auto;
    display: block;
    max-width: 90%;
    max-height: 90%;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    animation: zoomIn 0.3s;
}

.image-modal-close {
    position: absolute;
    top: 15px;
    right: 35px;
    color: #f1f1f1;
    font-size: 40px;
    font-weight: bold;
    cursor: pointer;
    z-index: 1001;
}

.image-modal-close:hover,
.image-modal-close:focus {
    color: #bbb;
    text-decoration: none;
}

.image-modal-caption {
    margin: auto;
    display: block;
    width: 80%;
    max-width: 700px;
    text-align: center;
    color: #ccc;
    padding: 10px 0;
    position: absolute;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes zoomIn {
    from { transform: translate(-50%, -50%) scale(0.5); }
    to { transform: translate(-50%, -50%) scale(1); }
}

@media only screen and (max-width: 700px) {
    .image-modal-content {
        width: 100%;
        max-width: 95%;
        max-height: 95%;
    }
    
    .image-modal-caption {
        font-size: 14px;
        bottom: 10px;
    }
    
    .image-modal-close {
        font-size: 30px;
        top: 10px;
        right: 20px;
    }
}
</style>

<script>
function openImageModal(modalId) {
    document.getElementById(modalId).style.display = "block";
    document.body.style.overflow = "hidden"; 
}

function closeImageModal(modalId) {
    document.getElementById(modalId).style.display = "none";
    document.body.style.overflow = "auto"; 
}


document.addEventListener('keydown', function(event) {
    if (event.key === 'Escape') {
        const modals = document.querySelectorAll('.image-modal');
        modals.forEach(modal => {
            if (modal.style.display === 'block') {
                modal.style.display = 'none';
                document.body.style.overflow = "auto";
            }
        });
    }
});
</script>

<h3 id="windows-defender">Windows Defender</h3>
<p>let run simple test by disabling windows defender.</p>




<div class="clickable-image-container">
    <img src="https://0xprimo.github.io/Active-Directory-Attack-Defense/images/lab-setup-test-2.png" 
         alt="Disable Windows Defender"
         width="800"
         
         class="clickable-image"
         onclick="openImageModal('img-d6965e5421d6100ecff609cfbd6b8f5a-42')"
         style="cursor: pointer;">
</div>


<div id="img-d6965e5421d6100ecff609cfbd6b8f5a-42" class="image-modal" onclick="closeImageModal('img-d6965e5421d6100ecff609cfbd6b8f5a-42')">
    <span class="image-modal-close">&times;</span>
    <img class="image-modal-content" src="https://0xprimo.github.io/Active-Directory-Attack-Defense/images/lab-setup-test-2.png" alt="Disable Windows Defender">
    <div class="image-modal-caption">Disable Windows Defender</div>
</div>

<style>
.clickable-image {
    transition: opacity 0.3s ease;
}

.clickable-image:hover {
    opacity: 0.8;
}

.image-modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.9);
    animation: fadeIn 0.3s;
}

.image-modal-content {
    margin: auto;
    display: block;
    max-width: 90%;
    max-height: 90%;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    animation: zoomIn 0.3s;
}

.image-modal-close {
    position: absolute;
    top: 15px;
    right: 35px;
    color: #f1f1f1;
    font-size: 40px;
    font-weight: bold;
    cursor: pointer;
    z-index: 1001;
}

.image-modal-close:hover,
.image-modal-close:focus {
    color: #bbb;
    text-decoration: none;
}

.image-modal-caption {
    margin: auto;
    display: block;
    width: 80%;
    max-width: 700px;
    text-align: center;
    color: #ccc;
    padding: 10px 0;
    position: absolute;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes zoomIn {
    from { transform: translate(-50%, -50%) scale(0.5); }
    to { transform: translate(-50%, -50%) scale(1); }
}

@media only screen and (max-width: 700px) {
    .image-modal-content {
        width: 100%;
        max-width: 95%;
        max-height: 95%;
    }
    
    .image-modal-caption {
        font-size: 14px;
        bottom: 10px;
    }
    
    .image-modal-close {
        font-size: 30px;
        top: 10px;
        right: 20px;
    }
}
</style>

<script>
function openImageModal(modalId) {
    document.getElementById(modalId).style.display = "block";
    document.body.style.overflow = "hidden"; 
}

function closeImageModal(modalId) {
    document.getElementById(modalId).style.display = "none";
    document.body.style.overflow = "auto"; 
}


document.addEventListener('keydown', function(event) {
    if (event.key === 'Escape') {
        const modals = document.querySelectorAll('.image-modal');
        modals.forEach(modal => {
            if (modal.style.display === 'block') {
                modal.style.display = 'none';
                document.body.style.overflow = "auto";
            }
        });
    }
});
</script>

<p>now lets query for event id 5001 with <code>winlog.event_id:5001</code></p>




<div class="clickable-image-container">
    <img src="https://0xprimo.github.io/Active-Directory-Attack-Defense/images/lab-setup-test-2-1.png" 
         alt="Query logs with event id 5001"
         width="800"
         
         class="clickable-image"
         onclick="openImageModal('img-af9de67f3f97c4d8abab35e3f6c2b6bb-43')"
         style="cursor: pointer;">
</div>


<div id="img-af9de67f3f97c4d8abab35e3f6c2b6bb-43" class="image-modal" onclick="closeImageModal('img-af9de67f3f97c4d8abab35e3f6c2b6bb-43')">
    <span class="image-modal-close">&times;</span>
    <img class="image-modal-content" src="https://0xprimo.github.io/Active-Directory-Attack-Defense/images/lab-setup-test-2-1.png" alt="Query logs with event id 5001">
    <div class="image-modal-caption">Query logs with event id 5001</div>
</div>

<style>
.clickable-image {
    transition: opacity 0.3s ease;
}

.clickable-image:hover {
    opacity: 0.8;
}

.image-modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.9);
    animation: fadeIn 0.3s;
}

.image-modal-content {
    margin: auto;
    display: block;
    max-width: 90%;
    max-height: 90%;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    animation: zoomIn 0.3s;
}

.image-modal-close {
    position: absolute;
    top: 15px;
    right: 35px;
    color: #f1f1f1;
    font-size: 40px;
    font-weight: bold;
    cursor: pointer;
    z-index: 1001;
}

.image-modal-close:hover,
.image-modal-close:focus {
    color: #bbb;
    text-decoration: none;
}

.image-modal-caption {
    margin: auto;
    display: block;
    width: 80%;
    max-width: 700px;
    text-align: center;
    color: #ccc;
    padding: 10px 0;
    position: absolute;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes zoomIn {
    from { transform: translate(-50%, -50%) scale(0.5); }
    to { transform: translate(-50%, -50%) scale(1); }
}

@media only screen and (max-width: 700px) {
    .image-modal-content {
        width: 100%;
        max-width: 95%;
        max-height: 95%;
    }
    
    .image-modal-caption {
        font-size: 14px;
        bottom: 10px;
    }
    
    .image-modal-close {
        font-size: 30px;
        top: 10px;
        right: 20px;
    }
}
</style>

<script>
function openImageModal(modalId) {
    document.getElementById(modalId).style.display = "block";
    document.body.style.overflow = "hidden"; 
}

function closeImageModal(modalId) {
    document.getElementById(modalId).style.display = "none";
    document.body.style.overflow = "auto"; 
}


document.addEventListener('keydown', function(event) {
    if (event.key === 'Escape') {
        const modals = document.querySelectorAll('.image-modal');
        modals.forEach(modal => {
            if (modal.style.display === 'block') {
                modal.style.display = 'none';
                document.body.style.overflow = "auto";
            }
        });
    }
});
</script>

<p>and we can check where this logs came from</p>




<div class="clickable-image-container">
    <img src="https://0xprimo.github.io/Active-Directory-Attack-Defense/images/lab-setup-test-2-2.png" 
         alt="Log provided by windows defender"
         width="800"
         
         class="clickable-image"
         onclick="openImageModal('img-3099ce7ee1ea1c6c2400cdaebbfcac1d-44')"
         style="cursor: pointer;">
</div>


<div id="img-3099ce7ee1ea1c6c2400cdaebbfcac1d-44" class="image-modal" onclick="closeImageModal('img-3099ce7ee1ea1c6c2400cdaebbfcac1d-44')">
    <span class="image-modal-close">&times;</span>
    <img class="image-modal-content" src="https://0xprimo.github.io/Active-Directory-Attack-Defense/images/lab-setup-test-2-2.png" alt="Log provided by windows defender">
    <div class="image-modal-caption">Log provided by windows defender</div>
</div>

<style>
.clickable-image {
    transition: opacity 0.3s ease;
}

.clickable-image:hover {
    opacity: 0.8;
}

.image-modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.9);
    animation: fadeIn 0.3s;
}

.image-modal-content {
    margin: auto;
    display: block;
    max-width: 90%;
    max-height: 90%;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    animation: zoomIn 0.3s;
}

.image-modal-close {
    position: absolute;
    top: 15px;
    right: 35px;
    color: #f1f1f1;
    font-size: 40px;
    font-weight: bold;
    cursor: pointer;
    z-index: 1001;
}

.image-modal-close:hover,
.image-modal-close:focus {
    color: #bbb;
    text-decoration: none;
}

.image-modal-caption {
    margin: auto;
    display: block;
    width: 80%;
    max-width: 700px;
    text-align: center;
    color: #ccc;
    padding: 10px 0;
    position: absolute;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes zoomIn {
    from { transform: translate(-50%, -50%) scale(0.5); }
    to { transform: translate(-50%, -50%) scale(1); }
}

@media only screen and (max-width: 700px) {
    .image-modal-content {
        width: 100%;
        max-width: 95%;
        max-height: 95%;
    }
    
    .image-modal-caption {
        font-size: 14px;
        bottom: 10px;
    }
    
    .image-modal-close {
        font-size: 30px;
        top: 10px;
        right: 20px;
    }
}
</style>

<script>
function openImageModal(modalId) {
    document.getElementById(modalId).style.display = "block";
    document.body.style.overflow = "hidden"; 
}

function closeImageModal(modalId) {
    document.getElementById(modalId).style.display = "none";
    document.body.style.overflow = "auto"; 
}


document.addEventListener('keydown', function(event) {
    if (event.key === 'Escape') {
        const modals = document.querySelectorAll('.image-modal');
        modals.forEach(modal => {
            if (modal.style.display === 'block') {
                modal.style.display = 'none';
                document.body.style.overflow = "auto";
            }
        });
    }
});
</script>

<h1 id="credits">Credits:</h1>
<ul>
<li><a href="https://www.youtube.com/watch?v=GWX19cpv21w&amp;list=PLG6KGSNK4PuBb0OjyDIdACZnb8AoNBeq6">MyDFIR Playlist</a></li>
</ul>

            </div>
        </article></main>
</div>
<footer class="footer">
    <span class="footer_item"> </span>
    &nbsp;

    <div class="footer_social-icons">
<a href="https://github.com/0xPrimo" target="_blank" rel="noopener noreferrer me"
    title="Github">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
    stroke-linecap="round" stroke-linejoin="round">
    <path
        d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22">
    </path>
</svg>
</a>
<a href="https://x.com/cr4ckeddd" target="_blank" rel="noopener noreferrer me"
    title="Twitter">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
    stroke-linecap="round" stroke-linejoin="round">
    <path
        d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z">
    </path>
</svg>
</a>
</div>
    <small class="footer_copyright">
        © 2025 Primo.
        Powered by <a href="https://github.com/hugo-sid/hugo-blog-awesome" target="_blank" rel="noopener">Hugo blog awesome</a>.
    </small>
</footer><a href="#" title="Go to top" id="totop">
    <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="currentColor" stroke="currentColor" viewBox="0 96 960 960">
    <path d="M283 704.739 234.261 656 480 410.261 725.739 656 677 704.739l-197-197-197 197Z"/>
</svg>

</a>


    




    
    
        
    

    
    
        
    



    
    <script src="https://0xprimo.github.io/js/main.min.35f435a5d8eac613c52daa28d8af544a4512337d3e95236e4a4978417b8dcb2f.js" integrity="sha256-NfQ1pdjqxhPFLaoo2K9USkUSM30&#43;lSNuSkl4QXuNyy8="></script>

    

</body>
</html>
